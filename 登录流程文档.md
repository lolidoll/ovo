# GitHub Pages éƒ¨ç½²ç™»å½•æµç¨‹è¯¦ç»†æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
- [å®Œæ•´ç™»å½•æµç¨‹](#å®Œæ•´ç™»å½•æµç¨‹)
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [å¯†é’¥ç³»ç»Ÿ](#å¯†é’¥ç³»ç»Ÿ)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### å‰ç«¯ (GitHub Pages)
- **åŸŸå**: `https://lolidoll.github.io/ovo/`
- **æ–‡ä»¶**: [index.html](index.html), [login.js](login.js)
- **åŠŸèƒ½**: ç”¨æˆ·ç•Œé¢ã€OAuth æµç¨‹å‘èµ·

### åç«¯ (Vercel)
- **åŸŸå**: `https://ovo-psi.vercel.app/`
- **API ç«¯ç‚¹**:
  - `/api/callback` - Discord OAuth å›è°ƒå¤„ç†
  - `/api/keys` - å¯†é’¥éªŒè¯
- **æ–‡ä»¶**: [api/callback.js](api/callback.js), [api/keys.js](api/keys.js)

### æ•°æ®å­˜å‚¨ (Vercel KV)
- **ç”¨é€”**: å­˜å‚¨ç™»å½•å¯†é’¥ã€ä½¿ç”¨è®°å½•

---

## ğŸš€ éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æµè§ˆå™¨                             â”‚
â”‚               https://lolidoll.github.io/ovo/                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Discord OAuth                            â”‚
â”‚           https://discord.com/oauth2/authorize               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vercel API                                â”‚
â”‚           https://ovo-psi.vercel.app/api/callback            â”‚
â”‚  - äº¤æ¢æˆæƒç è·å– Access Token                                â”‚
â”‚  - è·å–ç”¨æˆ·ä¿¡æ¯                                               â”‚
â”‚  - éªŒè¯ç™»å½•å¯†é’¥                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Vercel KV å­˜å‚¨                             â”‚
â”‚  - å­˜å‚¨ä¸€æ¬¡æ€§ç™»å½•å¯†é’¥                                         â”‚
â”‚  - è®°å½•å¯†é’¥ä½¿ç”¨æƒ…å†µ                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å®Œæ•´ç™»å½•æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šè®¿é—®ç½‘ç«™
```
ç”¨æˆ·è®¿é—®: https://lolidoll.github.io/ovo/
```

**ç³»ç»Ÿæ£€æŸ¥** ([login.js](login.js#L18-L30)):
```javascript
init() {
    // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
    if (this.isUserLoggedIn()) {
        return; // å·²ç™»å½•ï¼Œæ­£å¸¸æ˜¾ç¤º
    }
    
    // æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
    showLoginModal();
}
```

### ç¬¬äºŒæ­¥ï¼šè¾“å…¥å¯†é’¥
ç”¨æˆ·ç‚¹å‡»"Discord ç™»å½•"æŒ‰é’®åï¼Œç³»ç»Ÿè¦æ±‚è¾“å…¥ä¸€æ¬¡æ€§å¯†é’¥ï¼š

```javascript
// login.js å¯†é’¥è¾“å…¥æµç¨‹
async promptForKey() {
    const key = prompt('è¯·è¾“å…¥ç™»å½•å¯†é’¥');
    
    // éªŒè¯å¯†é’¥
    const response = await fetch('https://ovo-psi.vercel.app/api/keys?key=' + key);
    
    if (!response.ok) {
        alert('å¯†é’¥æ— æ•ˆæˆ–å·²ä½¿ç”¨');
        return null;
    }
    
    return key;
}
```

**å¯†é’¥éªŒè¯** ([api/keys.js](api/keys.js)):
- ä» Vercel KV æŸ¥è¯¢å¯†é’¥çŠ¶æ€
- æ£€æŸ¥å¯†é’¥æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦å·²ä½¿ç”¨
- æ ‡è®°å¯†é’¥ä¸ºå·²ä½¿ç”¨ï¼ˆä¸€æ¬¡æ€§ï¼‰

### ç¬¬ä¸‰æ­¥ï¼šè·³è½¬ Discord æˆæƒ

å¯†é’¥éªŒè¯é€šè¿‡åï¼Œè·³è½¬åˆ° Discord æˆæƒé¡µé¢ï¼š

```javascript
// login.js Discord æˆæƒ URL
const authUrl = `https://discord.com/api/oauth2/authorize?client_id=1463827536440983615&redirect_uri=https://lolidoll.github.io/ovo/index.html&response_type=code&scope=identify%20email&state=${state}`;

window.location.href = authUrl;
```

**æˆæƒå‚æ•°**:
- `client_id`: Discord åº”ç”¨ ID
- `redirect_uri`: æˆæƒåè·³è½¬åœ°å€
- `response_type`: è¿”å›æˆæƒç 
- `scope`: è¯·æ±‚çš„æƒé™ (identify, email)
- `state`: é˜²CSRFæ”»å‡»çš„éšæœºå­—ç¬¦ä¸²

### ç¬¬å››æ­¥ï¼šDiscord æˆæƒå›è°ƒ

ç”¨æˆ·åœ¨ Discord ç‚¹å‡»"æˆæƒ"åï¼ŒDiscord é‡å®šå‘å›ï¼š

```
https://lolidoll.github.io/ovo/index.html?code=æˆæƒç &state=éšæœºå­—ç¬¦ä¸²
```

**å‰ç«¯å¤„ç†** ([login.js](login.js#L80-L120)):
```javascript
handleAuthCallback() {
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');
    const state = params.get('state');
    
    // éªŒè¯ state é˜²æ­¢ CSRF
    if (!this.verifyState(state)) {
        alert('å®‰å…¨éªŒè¯å¤±è´¥');
        return;
    }
    
    // äº¤æ¢ token
    this.exchangeToken(code);
}
```

### ç¬¬äº”æ­¥ï¼šåç«¯äº¤æ¢ Token

å‰ç«¯å°†æˆæƒç å‘é€åˆ° Vercel APIï¼š

```javascript
// login.js Token äº¤æ¢
async exchangeToken(code) {
    const response = await fetch('https://ovo-psi.vercel.app/api/callback', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            code: code,
            client_id: '1463827536440983615',
            verified_key: 'ç”¨æˆ·è¾“å…¥çš„å¯†é’¥'
        })
    });
    
    const data = await response.json();
    // ä¿å­˜ token
    localStorage.setItem('discord_auth_token', data.access_token);
    localStorage.setItem('discord_user_data', JSON.stringify(data.user));
}
```

**åç«¯å¤„ç†** ([api/callback.js](api/callback.js#L28-L85)):
```javascript
// 1. éªŒè¯å¯†é’¥
const keyData = await kv.hget('login:keys', verified_key);
if (!keyData || keyData.used) {
    return res.status(403).json({ error: 'æ— æ•ˆçš„å¯†é’¥' });
}

// 2. äº¤æ¢æˆæƒç è·å– Access Token
const tokenResponse = await fetch('https://discord.com/api/v10/oauth2/token', {
    method: 'POST',
    body: new URLSearchParams({
        client_id: client_id,
        client_secret: process.env.DISCORD_CLIENT_SECRET,
        code: code,
        grant_type: 'authorization_code',
        redirect_uri: REDIRECT_URI,
    })
});

// 3. è·å–ç”¨æˆ·ä¿¡æ¯
const userResponse = await fetch('https://discord.com/api/v10/users/@me', {
    headers: { 'Authorization': `Bearer ${access_token}` }
});

// 4. è¿”å›ç»™å‰ç«¯
return res.json({
    access_token: tokenData.access_token,
    user: userData
});
```

### ç¬¬å…­æ­¥ï¼šç™»å½•å®Œæˆ

**å‰ç«¯ä¿å­˜ç™»å½•çŠ¶æ€**:
```javascript
localStorage.setItem('discord_auth_token', access_token);
localStorage.setItem('discord_user_data', JSON.stringify(user));
localStorage.setItem('discord_token_expiry', expiryTime);
```

**UI æ›´æ–°**:
- éšè—ç™»å½•æ¨¡æ€æ¡†
- æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
- å¯ç”¨åº”ç”¨åŠŸèƒ½

---

## âš™ï¸ ç¯å¢ƒé…ç½®

### Discord åº”ç”¨é…ç½®

1. è®¿é—® https://discord.com/developers/applications
2. åˆ›å»ºåº”ç”¨ï¼Œè·å– Client ID
3. é…ç½® OAuth2 é‡å®šå‘ URIï¼š
   ```
   https://lolidoll.github.io/ovo/index.html
   ```

### Vercel ç¯å¢ƒå˜é‡

åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­é…ç½®ï¼š

```env
DISCORD_CLIENT_SECRET=your_discord_client_secret
REDIS_URL=your_upstash_redis_url
REDIS_TOKEN=your_upstash_redis_token
```

### Vercel KV é…ç½®

é¡¹ç›®ç»‘å®š Vercel KV æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ï¼š
- `login:keys` - Hash å­˜å‚¨æ‰€æœ‰å¯†é’¥
- `login:usage:log` - List å­˜å‚¨ä½¿ç”¨æ—¥å¿—

---

## ğŸ”‘ å¯†é’¥ç³»ç»Ÿ

### å¯†é’¥æ ¼å¼

```javascript
{
    key: "xxxx-xxxx-xxxx-xxxx",
    note: "ç”¨é€”è¯´æ˜",
    used: false,
    createdAt: "2026-02-14T00:00:00.000Z",
    usedAt: null,
    usedBy: null
}
```

### å¯†é’¥å­˜å‚¨

ä½¿ç”¨ Vercel KV Hash å­˜å‚¨ï¼š
```javascript
await kv.hset('login:keys', key, JSON.stringify(keyData));
```

### å¯†é’¥éªŒè¯æµç¨‹

```
1. ç”¨æˆ·è¾“å…¥å¯†é’¥
   â†“
2. æŸ¥è¯¢ KV æ•°æ®åº“
   â†“
3. æ£€æŸ¥å¯†é’¥æ˜¯å¦å­˜åœ¨
   â†“
4. æ£€æŸ¥æ˜¯å¦å·²ä½¿ç”¨
   â†“
5. æ ‡è®°ä¸ºå·²ä½¿ç”¨
   â†“
6. è®°å½•ä½¿ç”¨æ—¥å¿—
   â†“
7. è¿”å›éªŒè¯ç»“æœ
```

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šCORS é”™è¯¯

**ç°è±¡**: æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºè·¨åŸŸé”™è¯¯

**åŸå› **: API å“åº”å¤´æœªæ­£ç¡®è®¾ç½® CORS

**è§£å†³**: [api/callback.js](api/callback.js#L6-L15) å·²è®¾ç½® CORS å¤´ï¼š
```javascript
const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
    'Access-Control-Allow-Headers': 'Content-Type, Authorization'
};
```

### é—®é¢˜ 2ï¼šå¯†é’¥éªŒè¯å¤±è´¥

**å¯èƒ½åŸå› **:
1. å¯†é’¥ä¸å­˜åœ¨
2. å¯†é’¥å·²ä½¿ç”¨
3. Vercel KV è¿æ¥å¤±è´¥

**è°ƒè¯•**:
```javascript
// æ£€æŸ¥ KV è¿æ¥
const status = await redis.get(key);
console.log('å¯†é’¥çŠ¶æ€:', status);
```

### é—®é¢˜ 3ï¼šDiscord æˆæƒå¤±è´¥

**å¯èƒ½åŸå› **:
1. Redirect URI ä¸åŒ¹é…
2. Client ID é”™è¯¯
3. Client Secret æœªé…ç½®

**æ£€æŸ¥é¡¹**:
- Discord åº”ç”¨åå°çš„ Redirect URI å¿…é¡»æ˜¯: `https://lolidoll.github.io/ovo/index.html`
- Vercel ç¯å¢ƒå˜é‡ `DISCORD_CLIENT_SECRET` å·²æ­£ç¡®è®¾ç½®

### é—®é¢˜ 4ï¼šToken äº¤æ¢å¤±è´¥

**é”™è¯¯ä»£ç **:
- `invalid_client`: Client ID/Secret é”™è¯¯
- `invalid_grant`: æˆæƒç è¿‡æœŸæˆ–å·²ä½¿ç”¨
- `redirect_uri_mismatch`: é‡å®šå‘ URI ä¸åŒ¹é…

---

## ğŸ“Š æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è®¿é—®    â”‚
â”‚  GitHub Pages â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ£€æŸ¥ç™»å½•çŠ¶æ€  â”‚ â”€â”€â–¶â”‚ å·²ç™»å½•? æ˜¯    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ å¦                  â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚ æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡† â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚                     â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  è¾“å…¥ç™»å½•å¯†é’¥  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚                     â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  éªŒè¯å¯†é’¥      â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  (Vercel API) â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚ æœ‰æ•ˆ                 â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚ è·³è½¬ Discord  â”‚             â”‚
â”‚   OAuth      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚                     â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  ç”¨æˆ·æˆæƒ      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚                     â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚ Discordå›è°ƒ   â”‚             â”‚
â”‚ (å¸¦æˆæƒç )    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚                     â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚ äº¤æ¢Token     â”‚             â”‚
â”‚  (Vercel API) â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚                     â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  è·å–ç”¨æˆ·ä¿¡æ¯  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚                     â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  ä¿å­˜åˆ°æœ¬åœ°    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚                     â”‚
       â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ç™»å½•æˆåŠŸï¼Œæ˜¾ç¤ºç•Œé¢       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ç›¸å…³æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| [login.js](login.js) | å‰ç«¯ç™»å½•é€»è¾‘ |
| [auth-modal.js](auth-modal.js) | ç™»å½•æ¨¡æ€æ¡† UI |
| [api/callback.js](api/callback.js) | Discord OAuth å›è°ƒå¤„ç† |
| [api/keys.js](api/keys.js) | å¯†é’¥éªŒè¯ API |
| [vercel.json](vercel.json) | Vercel éƒ¨ç½²é…ç½® |

---

**æ–‡æ¡£æ›´æ–°æ—¶é—´**: 2026å¹´2æœˆ14æ—¥
**éƒ¨ç½²ç¯å¢ƒ**: GitHub Pages + Vercel
