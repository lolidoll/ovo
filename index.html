<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- PWA配置 -->
    <link rel="manifest" href="manifest.json" onerror="console.warn('manifest.json加载失败，这在本地开发环境中是正常的')">
    
    <!-- Apple iOS配置 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="喵机1号">
    <link rel="apple-touch-icon" href="https://img.heliar.top/file/1771160270412_IMG_20260215_194554.jpg">
    
    <!-- Android/Chrome配置 -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ffffff">
    
    <!-- Edge浏览器全屏配置 -->
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="none">
    
    <!-- 通用全屏配置 -->
    <meta name="format-detection" content="telephone=no">
    <meta name="x5-fullscreen" content="true">
    <meta name="x5-page-mode" content="app">
    <meta name="full-screen" content="yes">
    <meta name="browsermode" content="application">
    
    <!-- 图标和标题 -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='50' font-size='90' fill='%23333'>喵</text></svg>">
    <title>喵机1号</title>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="fiction-styles-v2.css">
    <link rel="stylesheet" href="fiction-reader.css">
    <link rel="stylesheet" href="fiction-comments.css">
    <link rel="stylesheet" href="moments.css">
    <link rel="stylesheet" href="login.css">
    <link rel="stylesheet" href="auth-modal.css">
    <link rel="stylesheet" href="api-settings-styles.css">
    <link rel="stylesheet" href="wallet.css">
    <link rel="stylesheet" href="user-persona-styles.css">
    <link rel="stylesheet" href="mind-state-styles.css">
    <link rel="stylesheet" href="couples-space.css">
    <link rel="stylesheet" href="chat-qq-style.css">
    <link rel="stylesheet" href="group-chat.css">
    <link rel="stylesheet" href="voice-call.css">
    <link rel="stylesheet" href="video-call.css">
    <link rel="stylesheet" href="red-envelope.css">
    <link rel="stylesheet" href="transfer.css">
    <link rel="stylesheet" href="font-manager.css">
    <link rel="stylesheet" href="theme-manager.css">
    <link rel="stylesheet" href="iphone-simulator.css">
    <link rel="stylesheet" href="iphone-settings.css">
    <link rel="stylesheet" href="iphone-notes.css">
    <link rel="stylesheet" href="iphone-photos.css">
    <link rel="stylesheet" href="iphone-screentime.css">
    <link rel="stylesheet" href="iphone-calendar.css">
    <link rel="stylesheet" href="iphone-maps.css">
    <link rel="stylesheet" href="iphone-health.css">
    <link rel="stylesheet" href="iphone-wallet.css">
    <link rel="stylesheet" href="iphone-mail.css">
    <link rel="stylesheet" href="iphone-messages.css">
    <link rel="stylesheet" href="iphone-browser.css">
    <link rel="stylesheet" href="iphone-phone.css">
    <link rel="stylesheet" href="shopping.css">
    <link rel="stylesheet" href="shopping-cart.css">
    <link rel="stylesheet" href="mine-edit.css">
    <link rel="stylesheet" href="address-manager.css">
    <link rel="stylesheet" href="performance-styles.css">
    <link rel="stylesheet" href="settings-page-styles.css">
    <link rel="stylesheet" href="offline-chat.css">
    <link rel="stylesheet" href="st-preset-manager.css">
    <link rel="stylesheet" href="listen-together.css">
    <style>
    </style>
    <script>
        // 处理manifest.json加载失败（本地开发环境CORS问题）
        (function() {
            const manifestLink = document.querySelector('link[rel="manifest"]');
            if (manifestLink) {
                manifestLink.addEventListener('error', function() {
                    console.warn('manifest.json加载失败，这在本地开发环境中是正常的');
                    // 在本地开发环境中，手动设置PWA相关属性
                    if (!window.navigator.standalone && !window.matchMedia('(display-mode: standalone)').matches) {
                        console.log('当前不在PWA模式下');
                    }
                });
            }
        })();
    </script>
    <script>
        // 移动端全屏适配 - 动态计算视口高度
        (function() {
            // 获取用户选择的适配方案
            const adaptMode = localStorage.getItem('viewportAdaptMode') || 'auto';
            
            // 检测是否为iOS设备
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isIOSStandalone = isIOS && (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches);
            
            // 检测是否为Edge浏览器
            const isEdge = /Edg/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            const isEdgeAndroid = isEdge && isAndroid;
            
            // 检测是否为全屏模式（PWA模式）- 统一检测所有设备
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
                                 window.matchMedia('(display-mode: fullscreen)').matches ||
                                 window.navigator.standalone === true;
            
            // 统一的PWA模式标识 - 用于CSS样式控制
            const isPWA = isStandalone;
            
            function setViewportHeight() {
                // 获取真实的视口高度 - 优先使用visualViewport (更精准)
                let viewportHeight = window.innerHeight;
                
                // 对某些浏览器的特殊处理
                if (window.visualViewport) {
                    // visualViewport更精准，包括地址栏的动态变化
                    viewportHeight = window.visualViewport.height;
                }
                
                // 设置CSS自定义属性
                let vh = viewportHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
                document.documentElement.style.setProperty('--app-height', `${viewportHeight}px`);
                
                // 标记设备类型 - 统一的设备标识
                if (isIOS) {
                    document.documentElement.classList.add('is-ios');
                }
                
                if (isAndroid) {
                    document.documentElement.classList.add('is-android');
                }
                
                if (isEdge) {
                    document.documentElement.classList.add('is-edge');
                }
                
                // PWA模式统一标识 - 所有设备共用
                if (isPWA) {
                    document.documentElement.classList.add('is-pwa');
                    document.documentElement.classList.add('is-standalone');
                    
                    // iOS特殊标识（保持兼容性）
                    if (isIOS) {
                        document.documentElement.classList.add('ios-standalone');
                    }
                }
                
                // 标记适配模式
                document.documentElement.setAttribute('data-adapt-mode', adaptMode);
                
                // 调试日志
                if (window.__DEBUG_VIEWPORT__) {
                    console.log(`[Viewport] innerHeight: ${window.innerHeight}, visualViewport: ${window.visualViewport?.height || 'N/A'}, vh: ${vh}, isPWA: ${isPWA}`);
                }
            }
            
            // 初始设置
            setViewportHeight();
            
            // 监听窗口大小变化
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(setViewportHeight, 100);
            });
            
            // 监听设备方向变化
            window.addEventListener('orientationchange', function() {
                setTimeout(setViewportHeight, 200);
            });
            
            // 页面可见性变化时重新计算（处理浏览器地址栏显示/隐藏）
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    setTimeout(setViewportHeight, 100);
                }
            });
            
            // 滚动事件时重新计算（某些浏览器滚动时会改变地址栏状态）
            let scrollTimer;
            window.addEventListener('scroll', function() {
                clearTimeout(scrollTimer);
                scrollTimer = setTimeout(setViewportHeight, 100);
            }, { passive: true });
            
            // 页面加载完成后再次确认
            window.addEventListener('load', function() {
                setTimeout(setViewportHeight, 300);
            });
            
            // 处理visualViewport变化（地址栏动态显示/隐藏）
            if (window.visualViewport) {
                window.visualViewport.addEventListener('resize', function() {
                    setViewportHeight();
                });
            }
            
            // 非PWA模式下，注入动态样式修复
            if (!isPWA) {
                const fixStyle = document.createElement('style');
                fixStyle.id = 'non-pwa-viewport-fix';
                fixStyle.textContent = `
                    /* 非PWA模式：使用100dvh确保所有元素正确显示 */
                    html:not(.is-pwa):not(.is-standalone) body {
                        height: 100dvh;
                        height: 100vh;
                    }
                    
                    html:not(.is-pwa):not(.is-standalone) #app-container {
                        height: 100dvh;
                        height: 100vh;
                    }
                `;
                document.head.appendChild(fixStyle);
            }
        })();
        
        // 应用保存的页面缩放设置
        (function() {
            const savedScale = localStorage.getItem('pageZoomScale');
            if (savedScale) {
                const scale = parseFloat(savedScale);
                document.documentElement.style.setProperty('--page-scale', scale);
                document.documentElement.classList.add('page-scaled');
            }
        })();
    </script>
    <script src="background-keep-alive.js"></script>
    <script src="key-auth.js"></script>
    <script src="auth-modal.js" defer></script>
    <script src="login.js" defer></script>
    <script src="voice-message.js" defer></script>
    <script src="location-message.js" defer></script>
    <script src="emoji-manager.js" defer></script>
    <!-- mammoth.js 用于解析DOCX文件 -->
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <!-- JSZip 作为DOCX解析的备用方案 -->
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="worldbook.js" defer></script>
    <script src="user-persona-manager.js" defer></script>
    <script src="character-settings-manager.js" defer></script>
    <script src="mind-state-manager.js" defer></script>
    <script src="mind-state-display-enhanced.js" defer></script>
    <script src="api-utils.js" defer></script>
    <script src="secondary-api-manager.js" defer></script>
    <script src="main-api-manager.js" defer></script>
    <script src="ai-image-generator.js" defer></script>
    <script src="retry.js" defer></script>
    <script src="camera.js" defer></script>
    <script src="photo.js" defer></script>
    <script src="wallet.js" defer></script>
    <script src="couples-space.js" defer></script>
    <script src="moments-group-interaction.js" defer></script>
    <script src="moments.js" defer></script>
    <script src="voice-call.js" defer></script>
    <script src="video-call.js" defer></script>
    <script src="minimax-tts.js" defer></script>
    <script src="st-preset-manager.js" defer></script>
    <script src="offline-chat.js" defer></script>
    <script src="chat-qq-toolbar.js" defer></script>
    <script src="cors-proxy-fallback.js" defer></script>
    <script src="cors-proxy-smart-client.js" defer></script>
    <script src="fiction-reader.js" defer></script>
    <script src="fiction-comments.js" defer></script>
    <script src="fiction-module-v2.js" defer></script>
    <script src="group-chat.js" defer></script>
    <script src="performance-utils.js" defer></script>
    <script src="chat-render-optimizer.js" defer></script>
    <script src="mobile-performance-optimizer.js" defer></script>
    <script src="ios-paste-fix.js" defer></script>
    <script src="ios-input-fix.js" defer></script>
    <script src="ios-chat-fix.js" defer></script>
    <script src="mobile-touch-fix.js" defer></script>
    <script src="font-manager.js" defer></script>
    <script src="theme-manager.js" defer></script>
    <script src="iphone-simulator.js" defer></script>
    <script src="iphone-settings.js" defer></script>
    <script src="iphone-notes.js" defer></script>
    <script src="iphone-photos.js" defer></script>
    <script src="iphone-screentime.js" defer></script>
    <script src="iphone-calendar.js" defer></script>
    <script src="iphone-maps.js" defer></script>
    <script src="iphone-health.js" defer></script>
    <script src="iphone-wallet.js" defer></script>
    <script src="iphone-mail.js" defer></script>
    <script src="iphone-messages.js" defer></script>
    <script src="iphone-browser.js" defer></script>
    <script src="iphone-phone.js" defer></script>
    <script src="app.js" defer></script>
  
</head>
<body>
    <!-- 认证模态框 (新设计) -->
    <div class="auth-modal-overlay" id="auth-modal-overlay">
        <div class="auth-modal-container">
            <!-- 背景装饰 -->
            <div class="auth-bg-decoration"></div>
            
            <!-- 模态框内容 -->
            <div class="auth-modal-content">
                <!-- 像素装饰 -->
                <div class="pixel-deco pixel-deco-1"></div>
                <div class="pixel-deco pixel-deco-2"></div>
                
                <!-- 顶部装饰线 -->
                <div class="auth-top-bar"></div>
                
                <!-- Logo 和标题 -->
                <div class="auth-header">
                    <!-- 像素Logo - 动画方块 -->
                    <div class="auth-logo">
                        <div class="pixel-logo-glow"></div>
                        <div class="pixel-logo">
                            <div class="pixel-logo-inner">
                                <div class="pixel-logo-block"></div>
                                <div class="pixel-logo-block"></div>
                                <div class="pixel-logo-block"></div>
                                <div class="pixel-logo-block"></div>
                            </div>
                        </div>
                    </div>
                    <h1 class="auth-title">喵机1号</h1>
                    <p class="auth-subtitle">仅用于个人学习、开发、研究与欣赏<br>该小手机完全免费，如遇付费申请退款<br></p>
                </div>
                
                <!-- 主要内容 -->
                <div class="auth-main">
                    <!-- 密钥验证部分 -->
                    <div class="auth-key-section">
                        <div class="auth-intro">
                            <div class="auth-intro-item">
                                <div class="auth-intro-icon pixel-icon-rp"></div>
                                <div class="auth-intro-text">角色扮演</div>
                            </div>
                            <div class="auth-intro-item">
                                <div class="auth-intro-icon pixel-icon-chat"></div>
                                <div class="auth-intro-text">虚拟聊天</div>
                            </div>
                            <div class="auth-intro-item">
                                <div class="auth-intro-icon pixel-icon-ai"></div>
                                <div class="auth-intro-text">AI互动</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="auth-discord-section" style="display: none;">
                        <div class="auth-intro">
                            <div class="auth-intro-item">
                                <div class="auth-intro-icon pixel-icon-rp"></div>
                                <div class="auth-intro-text">角色扮演</div>
                            </div>
                            <div class="auth-intro-item">
                                <div class="auth-intro-icon pixel-icon-chat"></div>
                                <div class="auth-intro-text">虚拟聊天</div>
                            </div>
                            <div class="auth-intro-item">
                                <div class="auth-intro-icon pixel-icon-ai"></div>
                                <div class="auth-intro-text">AI互动</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 登录按钮 -->
                <div class="auth-actions">
                    <button class="auth-btn auth-btn-discord" id="auth-discord-btn">
                        <svg class="auth-btn-icon" viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M20.317 4.3671C18.7975 3.5373 17.147 2.9708 15.4545 2.7085C15.2087 3.1137 14.9369 3.6137 14.7562 4.0171C12.9712 3.7285 11.2146 3.7285 9.47812 4.0171C9.29745 3.6052 9.01312 3.1137 8.76437 2.7085C7.07382 2.9708 5.40277 3.5373 3.88233 4.3671C0.570533 9.1293 -0.0828944 13.7936 0.261145 18.3886C2.18418 19.7754 4.04779 20.6145 5.88147 21.1274C6.39521 20.4220 6.84365 19.6693 7.20782 18.8720C6.40771 18.5533 5.63360 18.1450 4.91162 17.6620C5.10249 17.5115 5.28905 17.3569 5.46412 17.1997C9.88141 19.4027 14.7457 19.4027 19.0528 17.1997C19.2278 17.3569 19.4149 17.5115 19.6011 17.6620C18.8791 18.1450 18.1045 18.5533 17.3046 18.8720C17.6684 19.6693 18.1169 20.4220 18.6307 21.1274C20.4645 20.6145 22.3281 19.7754 24.2511 18.3886C24.6314 13.3471 23.7067 8.8267 20.317 4.3671ZM8.02109 15.6503C6.8559 15.6503 5.90977 14.6039 5.90977 13.3287C5.90977 12.0535 6.8404 11.0071 8.02109 11.0071C9.20178 11.0071 10.1424 12.0535 10.1424 13.3287C10.1424 14.6039 9.20178 15.6503 8.02109 15.6503ZM15.9775 15.6503C14.8123 15.6503 13.8662 14.6039 13.8662 13.3287C13.8662 12.0535 14.7969 11.0071 15.9775 11.0071C17.1582 11.0071 18.0989 12.0535 18.0989 13.3287C18.0989 14.6039 17.1582 15.6503 15.9775 15.6503Z"/>
                        </svg>
                        <span>使用 Discord 登录</span>
                    </button>
                    
                    <p class="auth-tips">登录后将在此设备保持登录状态</p>
                </div>
                
                <!-- 加载状态 -->
                <div class="auth-loading" id="auth-loading" style="display: none;">
                    <div class="auth-spinner"></div>
                    <p>正在连接 Discord...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 消息通知栏 -->
    <div class="notification-bar" id="notification-bar">
        <div class="notification-content">
            <div class="notification-left">
                <div class="notification-avatar" id="notification-avatar">通</div>
                <div class="notification-info">
                    <div class="notification-name" id="notification-name">通知名称</div>
                    <div class="notification-preview" id="notification-preview">通知内容预览</div>
                </div>
            </div>
            <div class="notification-right">
                <div class="notification-time" id="notification-time">时间</div>
                <div class="notification-close" id="notification-close">×</div>
            </div>
        </div>
    </div>
    
    <div id="app-container">
        <!-- 顶部导航栏 -->
        <div class="top-nav" id="top-nav">
            <div class="user-info" id="user-info">
                <div class="user-avatar" id="user-avatar-display">喵</div>
                <div class="user-name">小喵1号</div>
            </div>
            <div class="add-btn" id="add-btn">
                <svg class="icon-svg" viewBox="0 0 24 24">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </div>
        </div>

        <!-- 添加弹窗 -->
        <div class="add-popup" id="add-popup">
            <div class="popup-item" id="add-friend-btn">
                <div class="popup-icon">
                    <svg class="icon-svg" viewBox="0 0 24 24">
                        <circle cx="10" cy="8" r="4"></circle>
                        <path d="M2 20c0-4 4-6 8-6"></path>
                        <line x1="19" y1="11" x2="19" y2="17"></line>
                        <line x1="16" y1="14" x2="22" y2="14"></line>
                    </svg>
                </div>
                <div class="popup-text">添加好友</div>
            </div>
            <div class="popup-divider"></div>
            <div class="popup-item" id="create-group-btn">
                <div class="popup-icon">
                    <svg class="icon-svg" viewBox="0 0 24 24">
                        <circle cx="9" cy="7" r="3"></circle>
                        <circle cx="15" cy="7" r="3"></circle>
                        <path d="M3 19c0-3 3-5 6-5"></path>
                        <path d="M15 14c3 0 6 2 6 5"></path>
                        <line x1="12" y1="17" x2="12" y2="21"></line>
                        <line x1="10" y1="19" x2="14" y2="19"></line>
                    </svg>
                </div>
                <div class="popup-text">创建群聊</div>
            </div>
            <div class="popup-divider"></div>
            <div class="popup-item" id="import-card-btn">
                <div class="popup-icon">
                    <svg class="icon-svg" viewBox="0 0 24 24">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </div>
                <div class="popup-text">导入角色卡</div>
            </div>
        </div>

        <!-- 侧边功能栏 -->
        <div class="side-menu" id="side-menu">
            <div class="card-info" id="card-info">
                <div class="card-bg" id="card-bg"></div>
                <div class="card-content">
                    <div class="card-avatar" id="card-avatar">喵</div>
                    <div class="card-name" id="display-name">小喵1号</div>
                    <div class="card-signature" id="card-signature">这个人很懒，什么都没写~</div>
                </div>
            </div>
            
            <div class="menu-list">
                <div class="menu-item" data-func="wallet">
                    <div class="menu-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24">
                            <rect x="2" y="6" width="20" height="14" rx="2"></rect>
                            <path d="M2 10h20"></path>
                            <circle cx="16" cy="14" r="1.5"></circle>
                        </svg>
                    </div>
                    <div class="menu-text">钱包</div>
                </div>
                
                <div class="menu-item" data-func="collection">
                    <div class="menu-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </div>
                    <div class="menu-text">收藏</div>
                </div>
                
                <div class="menu-item" data-func="emoji">
                    <div class="menu-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                            <line x1="9" y1="9" x2="9.01" y2="9"></line>
                            <line x1="15" y1="9" x2="15.01" y2="9"></line>
                        </svg>
                    </div>
                    <div class="menu-text">表情包</div>
                </div>
                
                <div class="menu-item" data-func="worldbook">
                    <div class="menu-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                            <path d="M12 13v2"></path>
                        </svg>
                    </div>
                    <div class="menu-text">世界书</div>
                </div>
                
                <div class="menu-divider"></div>
                
                <div class="menu-item" data-func="decoration">
                    <div class="menu-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 2v4"></path>
                            <path d="M12 18v4"></path>
                            <path d="M4.93 4.93l2.83 2.83"></path>
                            <path d="M16.24 16.24l2.83 2.83"></path>
                            <path d="M2 12h4"></path>
                            <path d="M18 12h4"></path>
                            <path d="M4.93 19.07l2.83-2.83"></path>
                            <path d="M16.24 7.76l2.83-2.83"></path>
                        </svg>
                    </div>
                    <div class="menu-text">个性装扮</div>
                </div>
                
                <div class="menu-item" data-func="api-settings">
                    <div class="menu-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24">
                            <rect x="3" y="3" width="7" height="7" rx="1"></rect>
                            <rect x="14" y="3" width="7" height="7" rx="1"></rect>
                            <rect x="3" y="14" width="7" height="7" rx="1"></rect>
                            <circle cx="17.5" cy="17.5" r="3.5"></circle>
                        </svg>
                    </div>
                    <div class="menu-text">API设置</div>
                </div>















                
                <div class="menu-item" data-func="couples-space">
                    <div class="menu-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                    </div>
                    <div class="menu-text">情侣空间</div>
                </div>
                
                <div class="menu-divider"></div>
                
                <div class="menu-item" data-func="user-persona">
                    <div class="menu-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="8" r="5"></circle>
                            <path d="M3 21c0-4 4-7 9-7s9 3 9 7"></path>
                        </svg>
                    </div>
                    <div class="menu-text">人设</div>
                </div>
                
                <div class="menu-item" data-func="preset">
                    <div class="menu-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24">
                            <rect x="3" y="3" width="7" height="7" rx="1"></rect>
                            <rect x="14" y="3" width="7" height="7" rx="1"></rect>
                            <rect x="3" y="14" width="7" height="7" rx="1"></rect>
                            <rect x="14" y="14" width="7" height="7" rx="1"></rect>
                        </svg>
                    </div>
                    <div class="menu-text">线下预设</div>
                </div>
                
                <div class="menu-item" data-func="settings">
                    <div class="menu-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                    </div>
                    <div class="menu-text">设置</div>
                </div>
            </div>
        </div>

        <!-- 遮罩层 -->
        <div class="mask" id="mask"></div>

        <!-- 消息页面搜索栏 -->
        <div class="search-bar msg-search-bar" id="msg-search-bar">
            <div class="search-wrapper">
                <svg class="icon-svg search-icon" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" class="search-input" placeholder="搜索" id="search-input-msg">
            </div>
        </div>

        <!-- 消息页面 -->
        <div class="main-content msg-page active" id="msg-page">
            <div class="msg-list" id="msg-list">
                <div class="empty-state" id="msg-empty">
                    <div class="empty-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24" style="width:100%;height:100%;">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2  2 0 0 1 2 2z"></path>
                            <line x1="9" y1="10" x2="15" y2="10"></line>
                        </svg>
                    </div>
                    <div class="empty-text">暂无消息<br>点击右上角添加好友开始聊天</div>
                </div>
            </div>
        </div>

        <!-- 好友页面搜索栏 -->
        <div class="search-bar friend-search-bar" id="friend-search-bar" style="display: none;">
            <div class="search-wrapper">
                <svg class="icon-svg search-icon" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" class="search-input" placeholder="搜索好友" id="search-input-friend">
            </div>
        </div>

        <!-- 好友页面 -->
        <div class="main-content friend-page" id="friend-page">
            <div class="friend-content" id="friend-content">
                <div class="friend-group">
                    <div class="group-header" data-group="common">
                        <div class="group-title-left">
                            <div class="group-arrow"></div>
                            <div class="group-title">我的好友</div>
                            <div class="group-count">(0/0)</div>
                        </div>
                        <div class="group-edit">管理</div>
                    </div>
                    <div class="friend-list show" data-group="common">
                        <div class="empty-state" style="padding: 30px 20px;">
                            <div class="empty-text">暂无好友</div>
                        </div>
                    </div>
                </div>
                
                <div class="friend-group">
                    <div class="group-header collapsed" data-group="groups">
                        <div class="group-title-left">
                            <div class="group-arrow"></div>
                            <div class="group-title">群聊管理</div>
                            <div class="group-count">(0/0)</div>
                        </div>
                        <div class="group-edit">管理</div>
                    </div>
                    <div class="friend-list" data-group="groups">
                        <div class="empty-state" style="padding: 30px 20px;">
                            <div class="empty-text">暂无群聊</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 动态页面 - 无顶部栏和搜索栏 -->
        <div class="main-content dynamic-page" id="dynamic-page">
            <div class="dynamic-content">
                <div class="func-list" id="func-list">
                    <!-- 朋友圈 -->
                    <div class="func-item" data-page="moments-page" data-func-id="moments">
                        <div class="func-left">
                            <div class="func-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <path d="M21 15l-5-5L5 21"></path>
                                </svg>
                            </div>
                            <div class="func-name">朋友圈</div>
                        </div>
                        <div class="func-arrow"></div>
                    </div>
                    
                    <!-- 论坛 -->
                    <div class="func-item" data-page="forum-page" data-func-id="forum">
                        <div class="func-left">
                            <div class="func-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    <line x1="8" y1="8" x2="16" y2="8"></line>
                                    <line x1="8" y1="12" x2="14" y2="12"></line>
                                </svg>
                            </div>
                            <div class="func-name">论坛</div>
                        </div>
                        <div class="func-arrow"></div>
                    </div>

                                        <!-- 阅读 -->
                    <div class="func-item" data-page="reading-page" data-func-id="reading">
                        <div class="func-left">
                            <div class="func-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                                    <line x1="8" y1="7" x2="16" y2="7"></line>
                                    <line x1="8" y1="11" x2="14" y2="11"></line>
                                </svg>
                            </div>
                            <div class="func-name">阅读</div>
                        </div>
                        <div class="func-arrow"></div>
                    </div>

                    <div class="func-divider"></div>

                    <!-- 天气 - 新添加的 -->
<div class="func-item" data-page="weather-page" data-func-id="weather">
    <div class="func-left">
        <div class="func-icon">
            <svg class="icon-svg" viewBox="0 0 24 24" fill="gray">
                <circle cx="12" cy="12" r="5"/>
                <line x1="12" y1="3" x2="12" y2="6"/>
                <line x1="12" y1="18" x2="12" y2="21"/>
                <line x1="3" y1="12" x2="6" y2="12"/>
                <line x1="18" y1="12" x2="21" y2="12"/>
                <line x1="4.22" y1="19.78" x2="6.64" y2="17.36"/>
                <line x1="17.36" y1="6.64" x2="19.78" y2="4.22"/>
                <line x1="4.22" y1="4.22" x2="6.64" y2="6.64"/>
                <line x1="17.36" y1="17.36" x2="19.78" y2="19.78"/>
            </svg>
        </div>
        <div class="func-name">天气</div>
    </div>
    <div class="func-arrow"></div>
</div>

                    <!-- 日历 -->
                    <div class="func-item" data-page="calendar-page" data-func-id="calendar">
                        <div class="func-left">
                            <div class="func-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </div>
                            <div class="func-name">日历</div>
                        </div>
                        <div class="func-arrow"></div>
                    </div>
                    
                    <div class="func-divider"></div>
                    
                    
    <!-- 购物 - 新添加的 -->
<div class="func-item" data-page="shopping-page" data-func-id="shopping">
        <div class="func-left">
            <div class="func-icon">
                <svg class="icon-svg" viewBox="0 0 24 24">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
            </div>
            <div class="func-name">购物</div>
        </div>
        <div class="func-arrow"></div>
    </div>

                    <!-- 游戏中心 -->
                    <div class="func-item" data-page="game-page" data-func-id="game">
                        <div class="func-left">
                            <div class="func-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <rect x="2" y="6" width="20" height="12" rx="2"></rect>
                                    <circle cx="6" cy="12" r="1.5"></circle>
                                    <circle cx="10" cy="12" r="1.5"></circle>
                                    <path d="M15 10v4"></path>
                                    <path d="M13 12h4"></path>
                                </svg>
                            </div>
                            <div class="func-name">游戏中心</div>
                        </div>
                        <div class="func-arrow"></div>
                    </div>

                    <div class="func-divider"></div>

                    <!-- 默契大挑战 -->
                    <div class="func-item" data-page="tacit-page" data-func-id="tacit">
                        <div class="func-left">
                            <div class="func-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                            </div>
                            <div class="func-name">默契大挑战</div>
                        </div>
                        <div class="func-arrow"></div>
                    </div>

                    <!-- 心灵星系 -->
                    <div class="func-item" data-page="spirit-galaxy-page" data-func-id="spiritGalaxy">
                        <div class="func-left">
                            <div class="func-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <polygon points="12 2 15.09 10.26 23.77 10.26 17.39 16.01 20.48 24.27 12 18.46 3.52 24.27 6.61 16.01 0.23 10.26 8.91 10.26"></polygon>
                                </svg>
                            </div>
                            <div class="func-name">心灵星系</div>
                        </div>
                        <div class="func-arrow"></div>
                    </div>

                    <!-- 灵感库 -->
                    <div class="func-item" data-page="idea-library-page" data-func-id="ideaLibrary">
                        <div class="func-left">
                            <div class="func-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8.5 8.5z"></path>
                                    <line x1="12" y1="7" x2="12" y2="13"></line>
                                    <line x1="9" y1="10" x2="15" y2="10"></line>
                                </svg>
                            </div>
                            <div class="func-name">灵感库</div>
                        </div>
                        <div class="func-arrow"></div>
                    </div>

                    <!-- 观察者 -->
                    <div class="func-item" data-page="third-party-page" data-func-id="thirdParty">
                        <div class="func-left">
                            <div class="func-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                </svg>
                            </div>
                            <div class="func-name">观察者</div>
                        </div>
                        <div class="func-arrow"></div>
                    </div>
                    
                    
                    <div class="func-divider"></div>

                </div>
                


                <!-- 更多功能按钮 -->
                <div class="more-func-item" id="more-func-btn">
                    <div class="more-func-text">更多功能 ›</div>
                </div>
            </div>
        </div>

        <!-- 底部标签栏 -->
        <div class="tab-bar" id="tab-bar">
            <div class="tab-item active" data-tab="msg-page">
                <div class="tab-icon">
                    <svg class="icon-svg" viewBox="0 0 24 24">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                </div>
                <div class="tab-text">消息</div>
            </div>
            <div class="tab-item" data-tab="friend-page">
                <div class="tab-icon">
                    <svg class="icon-svg" viewBox="0 0 24 24">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </div>
                <div class="tab-text">好友</div>
            </div>
            <div class="tab-item" data-tab="dynamic-page">
                <div class="tab-icon">
                    <svg class="icon-svg" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 6v6l4 2"></path>
                    </svg>
                </div>
                <div class="tab-text">动态</div>
            </div>
        </div>

        <!-- 添加好友页面 -->
        <div class="add-friend-page" id="add-friend-page">
            <div class="sub-nav">
                <div class="back-btn" id="add-friend-back-btn">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">添加好友</div>
            </div>
            <div class="add-page-content">
                <div class="add-section">
                    <div class="add-section-header">基本信息</div>
                    <div class="add-input-group">
                        <label class="add-input-label">名称 *</label>
                        <input type="text" class="add-input" id="friend-name-input" placeholder="输入好友名称">
                    </div>
                    <div class="add-input-group">
                        <label class="add-input-label">头像URL（可选）</label>
                        <input type="text" class="add-input" id="friend-avatar-input" placeholder="输入头像图片链接">
                    </div>
                    <div class="add-input-group">
                        <label class="add-input-label">人设描述（可选）</label>
                        <textarea class="add-textarea" id="friend-desc-input" placeholder="描述TA的性格、背景等..."></textarea>
                    </div>
                    <div class="add-input-group">
                        <label class="add-input-label">开场白（可选）</label>
                        <textarea class="add-textarea" id="friend-greeting-input" placeholder="TA第一次说的话..."></textarea>
                    </div>
                </div>
                
                <div class="add-btn-group">
                    <button class="add-cancel-btn" id="add-friend-cancel">取消</button>
                    <button class="add-submit-btn" id="add-friend-submit">添加好友</button>
                </div>
            </div>
        </div>

        <!-- 创建群聊页面（多成员选择） -->
        <div class="create-group-page" id="create-group-page">
            <div class="sub-nav">
                <div class="back-btn" id="create-group-back-btn">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">创建群聊</div>
            </div>
            <div class="create-group-content">
                <!-- 群头像区域 - 与群聊设置页一致 -->
                <div class="char-avatar-section">
                    <div class="avatar-container" style="justify-content:center;">
                        <div class="avatar-wrapper char-avatar-wrapper">
                            <div class="avatar-glow"></div>
                            <div class="avatar-display clickable-avatar" id="cg-avatar-picker" style="width:72px;height:72px;" title="点击上传群头像">
                                <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="rgba(255,255,255,0.7)" stroke-width="1.5"><path d="M23 19V5a2 2 0 0 0-2-2H3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2z"/><circle cx="12" cy="13" r="4"/></svg>
                            </div>
                            <div class="avatar-label">点击上传头像</div>
                        </div>
                    </div>
                    <input type="file" id="cg-avatar-file-input" accept="image/*" style="display:none;">
                    <input type="text" id="group-avatar-input" style="display:none;">
                </div>

                <!-- 群聊信息卡片 -->
                <div class="settings-card">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" class="card-icon"><circle cx="9" cy="7" r="3"/><circle cx="15" cy="7" r="3"/><path d="M3 19c0-3 3-5 6-5"/><path d="M15 14c3 0 6 2 6 5"/></svg>
                        <span>群聊信息</span>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">群名称</label>
                            <input type="text" class="form-input" id="group-name-input" placeholder="请输入群名称">
                        </div>
                        <div class="form-group">
                            <label class="form-label">群公告</label>
                            <textarea class="form-textarea" id="group-desc-input" placeholder="输入群公告内容..." style="min-height:100px;"></textarea>
                        </div>
                    </div>
                </div>

                <!-- 从好友中选择成员 -->
                <div class="settings-card">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" class="card-icon"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                        <span>选择群成员 <span style="color:#999;font-weight:400;font-size:12px;" id="cg-member-count">(已选 0 人)</span></span>
                    </div>
                    <div class="card-body">
                        <div class="cg-friend-list" id="cg-friend-list">
                            <!-- 动态渲染好友列表 -->
                        </div>
                    </div>
                </div>

                <!-- 已选成员预览 -->
                <div class="cg-selected-bar" id="cg-selected-bar" style="display:none;">
                    <div class="cg-selected-avatars" id="cg-selected-avatars"></div>
                </div>

                <!-- 额外添加自定义角色 -->
                <div class="settings-card">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" class="card-icon"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        <span>额外添加角色</span>
                    </div>
                    <div class="card-body">
                        <div class="cg-custom-members" id="cg-custom-members">
                            <!-- 动态添加的自定义角色卡片 -->
                        </div>
                        <button class="cg-add-custom-btn" id="cg-add-custom-btn">
                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            添加自定义角色
                        </button>
                    </div>
                </div>

                <!-- 底部操作按钮 -->
                <div class="cg-btn-group">
                    <button class="cg-cancel-btn" id="create-group-cancel">取消</button>
                    <button class="cg-submit-btn" id="create-group-submit">创建群聊</button>
                </div>
            </div>
        </div>

        <!-- 添加自定义群成员弹窗 -->
        <div class="cg-custom-modal" id="cg-custom-modal" style="display:none;">
            <div class="cg-custom-modal-content">
                <div class="cg-custom-modal-header">添加自定义角色</div>
                <div class="cg-custom-modal-body">
                    <div class="cg-custom-avatar-row">
                        <div class="cg-custom-avatar-preview" id="cg-custom-avatar-preview" title="点击上传头像">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </div>
                        <input type="file" id="cg-custom-avatar-file" accept="image/*" style="display:none;">
                        <input type="text" class="form-input" id="cg-custom-avatar-url" placeholder="或输入头像URL">
                    </div>
                    <input type="text" class="form-input" id="cg-custom-name" placeholder="角色名称">
                    <textarea class="form-textarea" id="cg-custom-desc" placeholder="角色设定（可选）" style="min-height:80px;"></textarea>
                </div>
                <div class="cg-custom-modal-footer">
                    <button class="cg-cancel-btn" id="cg-custom-cancel">取消</button>
                    <button class="cg-submit-btn" id="cg-custom-confirm">确认添加</button>
                </div>
            </div>
        </div>

        <!-- 导入角色卡页面 -->
        <div class="add-friend-page" id="import-card-page">
            <div class="sub-nav">
                <div class="back-btn" id="import-card-back-btn">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">导入角色卡</div>
            </div>
            <div class="add-page-content">
                <div class="import-section">
                    <div class="import-title">
                        <svg class="icon-svg" viewBox="0 0 24 24" style="width:20px;height:20px;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        批量导入角色卡
                    </div>
                    <div class="import-desc">
                        支持 SillyTavern 格式的 JSON 角色卡文件，可一次选择多个文件批量导入。
                    </div>
                    <div class="import-btn" id="import-file-btn">
                        <svg class="icon-svg" viewBox="0 0 24 24" style="width:20px;height:20px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        点击选择文件
                    </div>
                    <input type="file" class="import-file-input" id="import-file-input" accept=".json" multiple>
                    
                    <div class="import-preview" id="import-preview"></div>
                    <button class="import-all-btn" id="import-all-btn">导入全部角色</button>
                </div>

                <div class="import-section">
                    <div class="import-title">
                        <svg class="icon-svg" viewBox="0 0 24 24" style="width:20px;height:20px;">
                            <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                        从图片导入角色卡
                    </div>
                    <div class="import-desc">
                        支持导入含有角色卡信息的图片（如SillyTavern头像卡），可自动识别或手动配置角色信息。
                    </div>
                    <div class="import-btn" id="import-image-btn">
                        <svg class="icon-svg" viewBox="0 0 24 24" style="width:20px;height:20px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        点击选择图片
                    </div>
                    <input type="file" class="import-file-input" id="import-image-input" accept="image/*" multiple>
                </div>
                
                <div class="import-section">
                    <div class="import-title">
                        <svg class="icon-svg" viewBox="0 0 24 24" style="width:20px;height:20px;">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        角色卡格式说明
                    </div>
                    <div class="import-desc">
                        支持的JSON格式：<br>
                        • SillyTavern V2 格式 (spec: chara_card_v2)<br>
                        • SillyTavern V1 格式<br>
                        • 简单格式 {name, description, first_mes}<br><br>
                        必需字段：name（角色名称）<br>
                        可选字段：description, personality, first_mes, avatar, scenario, mes_example
                    </div>
                </div>
            </div>
        </div>

        <!-- 子页面 - 朋友圈 -->
        <div class="sub-page" id="moments-page">
            <!-- 顶部导航 - 全透明 -->
            <div class="moments-top-bar">
                <button class="back-btn moments-back-btn" data-back="moments-page">返回</button>
                <div class="moments-icon-group">
                    <button class="moments-icon-btn" id="notificationBtn">通知</button>
                    <button class="moments-icon-btn" id="settingBtn">设置</button>
                </div>
            </div>
            <div class="sub-content" style="padding: 0; background: #ffffff; overflow-y: auto;">
                <style>
                    :root {
                        --bg-image: url('');
                        --bg-color: #ffffff;
                        --pixel-font: "Pixelify Sans", sans-serif;
                        --main-pink: #ff6b9d;
                        --light-pink: #ffccd5;
                        --soft-white: #fefefe;
                    }

                    /* 顶部导航 - 全透明 */
                    #moments-page .moments-top-bar {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px 18px;
                        position: sticky;
                        top: 0;
                        background: transparent;
                        z-index: 100;
                        box-shadow: none;
                        border: none;
                    }

                    #moments-page .moments-back-btn,
                    #moments-page .moments-icon-btn {
                        background: transparent;
                        border: none;
                        font-size: 15px;
                        cursor: pointer;
                        font-family: var(--pixel-font);
                        color: #555;
                        padding: 6px 12px;
                        border-radius: 6px;
                        transition: all 0.2s;
                    }

                    #moments-page .moments-back-btn:hover,
                    #moments-page .moments-icon-btn:hover {
                        background: var(--light-pink);
                        color: var(--main-pink);
                    }

                    #moments-page .moments-icon-group {
                        display: flex;
                        gap: 12px;
                    }

                    #moments-page .profile-section {
                        display: flex;
                        align-items: center;
                        padding: 15px 20px;
                        gap: 15px;
                        margin-bottom: 5px;
                    }

                    #moments-page .avatar {
                        width: 65px;
                        height: 65px;
                        border-radius: 50%;
                        border: 2px solid var(--light-pink);
                        cursor: pointer;
                        transition: transform 0.2s;
                        object-fit: cover;
                    }

                    #moments-page .avatar:hover {
                        transform: scale(1.05);
                    }

                    #moments-page .profile-info h2 {
                        font-size: 20px;
                        color: var(--main-pink);
                        text-shadow: 1px 1px 0 #fff;
                        cursor: pointer;
                        display: inline-block;
                        margin: 0;
                    }

                    #moments-page .profile-info h2:hover {
                        text-decoration: underline;
                    }

                    #moments-page .profile-info p {
                        font-size: 14px;
                        color: #999;
                        margin: 4px 0 0 0;
                    }

                    #moments-page .function-nav {
                        display: flex;
                        justify-content: space-around;
                        padding: 12px 0;
                        margin: 5px 10px;
                        background: transparent;
                    }

                    #moments-page .func-btn {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        gap: 4px;
                        text-decoration: none;
                        color: #333;
                        font-size: 14px;
                        font-weight: 500;
                        transition: color 0.2s;
                        cursor: pointer;
                        background: none;
                        border: none;
                    }

                    #moments-page .func-btn:hover {
                        color: var(--main-pink);
                    }

                    #moments-page .input-wrapper {
                        margin: 5px 10px;
                        padding: 10px;
                        background: transparent;
                        display: flex;
                        align-items: center;
                    }

                    #moments-page .input-wrapper input {
                        flex: 1;
                        border: none;
                        background: transparent;
                        font-family: var(--pixel-font);
                        font-size: 14px;
                        color: #666;
                        outline: none;
                        text-align: left;
                        padding-left: 0;
                        cursor: pointer;
                    }

                    #moments-page .input-wrapper input::placeholder {
                        color: #ccc;
                        text-align: left;
                    }

                    #moments-page .input-wrapper input:focus {
                        background-color: #f5f5f5;
                        border-radius: 4px;
                        padding: 4px 8px;
                    }

                    #moments-page .feed-list {
                        padding: 0 10px;
                        margin-top: 5px;
                    }

                    #moments-page .feed-item {
                        background: transparent;
                        padding: 12px;
                        margin-bottom: 12px;
                        border-bottom: 1px solid #f0f0f0;
                    }

                    #moments-page .feed-header {
                        display: flex;
                        align-items: center;
                        margin-bottom: 8px;
                        gap: 10px;
                    }

                    #moments-page .feed-avatar {
                        width: 35px;
                        height: 35px;
                        border-radius: 50%;
                        object-fit: cover;
                    }

                    #moments-page .feed-user-info {
                        display: flex;
                        flex-direction: column;
                        flex: 1;
                    }

                    #moments-page .feed-username {
                        font-size: 14px;
                        color: var(--main-pink);
                        font-weight: 500;
                    }

                    #moments-page .feed-content {
                        font-size: 14px;
                        line-height: 1.5;
                        margin-bottom: 10px;
                        padding-left: 45px;
                    }

                    #moments-page .feed-images {
                        padding-left: 45px;
                        display: flex;
                        flex-wrap: wrap;
                        gap: 8px;
                        margin-bottom: 10px;
                    }

                    #moments-page .feed-images img {
                        max-width: 150px;
                        max-height: 150px;
                        border-radius: 4px;
                        cursor: pointer;
                        object-fit: cover;
                    }

                    #moments-page .feed-actions {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        gap: 15px;
                    }

                    #moments-page .action-btn {
                        background: transparent;
                        border: none;
                        font-size: 14px;
                        cursor: pointer;
                        font-family: var(--pixel-font);
                        color: #666;
                        transition: color 0.2s;
                    }

                    #moments-page .action-btn:hover {
                        color: var(--main-pink);
                    }

                    #moments-page .feed-time {
                        font-size: 12px;
                        color: #999;
                    }

                    #moments-page .comment-input {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        margin-top: 12px;
                        padding: 8px 0 0 0;
                        padding-left: 45px;
                    }

                    #moments-page .comment-avatar {
                        width: 28px;
                        height: 28px;
                        border-radius: 50%;
                        cursor: pointer;
                        transition: transform 0.2s;
                        object-fit: cover;
                    }

                    #moments-page .comment-avatar:hover {
                        transform: scale(1.05);
                    }

                    #moments-page .comment-input input {
                        flex: 1;
                        border: none;
                        background: transparent;
                        font-family: var(--pixel-font);
                        font-size: 13px;
                        color: #666;
                        padding: 6px 0;
                        outline: none;
                    }

                    #moments-page .comment-input input::placeholder {
                        color: #ccc;
                    }

                    #moments-page .comment-input input:focus {
                        background-color: #f5f5f5;
                        border-radius: 4px;
                        padding: 4px 8px;
                    }

                    #moments-page .modal {
                        display: none;
                        position: fixed;
                        z-index: 200;
                        left: 0;
                        top: 0;
                        width: 100%;
                        height: 100%;
                        background-color: rgba(0, 0, 0, 0.5);
                    }

                    #moments-page .modal.show {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }

                    #moments-page .modal-content {
                        background-color: #fff;
                        padding: 20px;
                        border-radius: 8px;
                        max-width: 500px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                    }

                    #moments-page .modal-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 15px;
                        border-bottom: 1px solid #f0f0f0;
                        padding-bottom: 10px;
                    }

                    #moments-page .modal-header h3 {
                        font-size: 18px;
                        color: var(--main-pink);
                        margin: 0;
                    }

                    #moments-page .close-btn {
                        background: none;
                        border: none;
                        font-size: 28px;
                        cursor: pointer;
                        color: #999;
                        transition: color 0.2s;
                    }

                    #moments-page .close-btn:hover {
                        color: var(--main-pink);
                    }

                    #moments-page .modal-body {
                        margin-bottom: 15px;
                    }

                    #moments-page #momentText {
                        width: 100%;
                        min-height: 100px;
                        padding: 10px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        font-family: var(--pixel-font);
                        font-size: 14px;
                        resize: vertical;
                        margin-bottom: 10px;
                    }

                    #moments-page #momentText:focus {
                        outline: none;
                        border-color: var(--main-pink);
                    }

                    #moments-page .image-preview {
                        display: flex;
                        flex-wrap: wrap;
                        gap: 10px;
                        margin-bottom: 10px;
                        min-height: 20px;
                    }

                    #moments-page .image-preview>div {
                        position: relative;
                        display: inline-block;
                    }

                    #moments-page .image-preview img {
                        max-width: 100px;
                        max-height: 100px;
                        border-radius: 4px;
                        object-fit: cover;
                    }

                    #moments-page .remove-btn {
                        position: absolute;
                        top: -8px;
                        right: -8px;
                        background: var(--main-pink);
                        color: white;
                        border: none;
                        border-radius: 50%;
                        width: 24px;
                        height: 24px;
                        cursor: pointer;
                        font-size: 16px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 0;
                    }

                    #moments-page .group-select {
                        margin-bottom: 15px;
                    }

                    #moments-page .group-select label {
                        display: block;
                        margin-bottom: 5px;
                        font-size: 14px;
                        color: #333;
                    }

                    #moments-page #groupSelect {
                        width: 100%;
                        padding: 8px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        font-family: var(--pixel-font);
                        font-size: 14px;
                    }

                    #moments-page #groupSelect:focus {
                        outline: none;
                        border-color: var(--main-pink);
                    }

                    #moments-page .modal-actions {
                        display: flex;
                        gap: 10px;
                        justify-content: flex-end;
                    }

                    #moments-page .submit-btn {
                        background: var(--main-pink);
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-family: var(--pixel-font);
                        font-size: 14px;
                        transition: all 0.2s;
                    }

                    #moments-page .submit-btn:hover {
                        background: #ff5a8b;
                    }

                    #moments-page .upload-btn {
                        background: white;
                        color: var(--main-pink);
                        border: 1px solid var(--main-pink);
                        padding: 8px 16px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-family: var(--pixel-font);
                        font-size: 14px;
                        transition: all 0.2s;
                    }

                    #moments-page .upload-btn:hover {
                        background: var(--light-pink);
                    }

                    #moments-page .notification-item {
                        padding: 10px;
                        margin-bottom: 10px;
                        background: #f9f9f9;
                        border-radius: 4px;
                        border-left: 3px solid var(--main-pink);
                    }

                    #moments-page .notification-header {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 5px;
                    }

                    #moments-page .notification-user {
                        color: var(--main-pink);
                        font-weight: 500;
                    }

                    #moments-page .notification-time {
                        color: #999;
                        font-size: 12px;
                    }

                    #moments-page .notification-text {
                        color: #333;
                        font-size: 13px;
                        line-height: 1.4;
                    }

                    #moments-page .more-options {
                        display: flex;
                        flex-direction: column;
                        gap: 10px;
                    }

                    #moments-page .option-btn {
                        padding: 12px;
                        border: 1px solid var(--light-pink);
                        background: white;
                        color: var(--main-pink);
                        border-radius: 4px;
                        cursor: pointer;
                        font-family: var(--pixel-font);
                        font-size: 14px;
                        transition: all 0.2s;
                    }

                    #moments-page .option-btn:hover {
                        background: var(--light-pink);
                        border-color: var(--main-pink);
                    }

                    #moments-page .character-select {
                        margin-bottom: 15px;
                    }

                    #moments-page .character-select label {
                        display: block;
                        margin-bottom: 5px;
                        font-size: 14px;
                        color: #333;
                    }

                    #moments-page #characterSelect {
                        width: 100%;
                        padding: 8px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        font-family: var(--pixel-font);
                        font-size: 14px;
                    }

                    #moments-page #characterSelect:focus {
                        outline: none;
                        border-color: var(--main-pink);
                    }

                    #moments-page .character-moment-options {
                        margin-bottom: 15px;
                    }

                    #moments-page .character-moment-options label {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        margin-bottom: 10px;
                        cursor: pointer;
                        font-size: 14px;
                    }

                    #moments-page #characterMomentText {
                        width: 100%;
                        min-height: 80px;
                        padding: 10px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        font-family: var(--pixel-font);
                        font-size: 14px;
                        resize: vertical;
                        margin-bottom: 10px;
                    }

                    #moments-page .auto-setting {
                        display: flex;
                        flex-direction: column;
                        gap: 12px;
                    }

                    #moments-page .auto-setting label {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        font-size: 14px;
                    }

                    #moments-page .auto-setting input[type="number"] {
                        width: 60px;
                        padding: 4px 8px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        font-family: var(--pixel-font);
                    }

                    #moments-page .comment-thread {
                        max-height: 300px;
                        overflow-y: auto;
                        margin-bottom: 15px;
                        padding: 10px;
                        background: #f9f9f9;
                        border-radius: 4px;
                    }

                    #moments-page .comments-section {
                        margin-top: 12px;
                        padding-left: 45px;
                        padding-top: 8px;
                        border-top: 1px solid #f0f0f0;
                    }

                    #moments-page .comment-item {
                        margin-bottom: 10px;
                        padding: 8px;
                        background: #f9f9f9;
                        border-radius: 4px;
                        font-size: 13px;
                    }

                    #moments-page .comment-header {
                        display: flex;
                        align-items: center;
                        gap: 4px;
                        margin-bottom: 4px;
                    }

                    #moments-page .comment-user {
                        color: var(--main-pink);
                        font-weight: 500;
                    }

                    #moments-page .comment-delete-btn {
                        color: #bbb;
                        background: none;
                        border: none;
                        cursor: pointer;
                        font-family: var(--pixel-font);
                        font-size: 12px;
                        padding: 0 2px;
                        transition: color 0.2s;
                        line-height: 1;
                    }

                    #moments-page .comment-delete-btn:hover {
                        color: #999;
                    }

                    #moments-page .comment-text {
                        color: #333;
                        line-height: 1.4;
                        margin-top: 4px;
                    }

                    #moments-page .comment-input-box {
                        display: flex;
                        flex-direction: column;
                        gap: 10px;
                    }

                    #moments-page #commentInputText {
                        width: 100%;
                        min-height: 60px;
                        padding: 10px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        font-family: var(--pixel-font);
                        font-size: 13px;
                        resize: vertical;
                    }

                    #moments-page #commentInputText:focus {
                        outline: none;
                        border-color: var(--main-pink);
                    }

                    #moments-page .icon-group {
                        display: flex;
                        gap: 12px;
                    }

                    .icon-btn {
                        background: transparent;
                        border: none;
                        font-size: 14px;
                        cursor: pointer;
                        color: #555;
                        padding: 6px 12px;
                        border-radius: 6px;
                        transition: all 0.2s;
                        font-family: var(--pixel-font);
                    }

                    .icon-btn:hover {
                        background: var(--light-pink);
                        color: var(--main-pink);
                    }
                </style>

                <!-- 个人信息 -->
                <div class="profile-section">
                    <img src="" alt="头像" class="avatar" id="profileAvatar" onclick="document.getElementById('profileAvatarInput').click()">
                    <input type="file" id="profileAvatarInput" accept="image/*" style="display:none;" onchange="changeProfileAvatar(this)">
                    <div class="profile-info">
                        <h2 id="profileName">用户名</h2>
                        <p>访客总量 <span id="visitorCount">0</span></p>
                    </div>
                </div>

                <!-- 功能导航 -->
                <div class="function-nav">
                    <button class="func-btn" data-tab="moments">说说</button>
                    <button class="func-btn" data-tab="log">日志</button>
                    <button class="func-btn" data-tab="photos">相册</button>
                    <button class="func-btn" data-tab="message">留言</button>
                    <button class="func-btn" data-tab="more">更多</button>
                </div>

                <!-- 说说输入框 -->
                <div class="input-wrapper">
                    <input type="text" id="momentInput" placeholder="分享新鲜事..." readonly onclick="openMomentDialog()">
                </div>

                <!-- 说说列表 -->
                <div class="feed-list" id="feedList">
                    <!-- 动态内容将在这里插入 -->
                </div>

                <!-- 发布朋友圈对话框 -->
                <div class="modal" id="momentModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>发布朋友圈</h3>
                            <button class="close-btn" onclick="closeMomentDialog()">×</button>
                        </div>
                        <div class="modal-body">
                            <!-- 文字输入 -->
                            <textarea id="momentText" placeholder="说说你的想法..."></textarea>
                            
                            <!-- 图片预览 -->
                            <div id="imagePreview" class="image-preview">
                                <!-- 图片将在这里显示 -->
                            </div>
                            
                            <!-- 好友分组选择 -->
                            <div class="group-select">
                                <label>分组可见：</label>
                                <select id="groupSelect">
                                    <!-- 选项将动态生成 -->
                                </select>
                            </div>
                            
                            <!-- 按钮区 -->
                            <div class="modal-actions">
                                <button class="upload-btn" onclick="document.getElementById('imageInput').click()">
                                    添加图片
                                </button>
                                <input type="file" id="imageInput" accept="image/*" multiple style="display:none;" onchange="handleImageSelect(this)">
                                <button class="submit-btn" onclick="publishMoment()">发布</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 设置背景对话框 -->
                <input type="file" id="bgFileInput" accept="image/*" onchange="changeBackground(this)" style="display:none;">

                <!-- 通知对话框 -->
                <div class="modal" id="notificationModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>朋友圈通知</h3>
                            <button class="close-btn" onclick="closeNotificationModal()">×</button>
                        </div>
                        <div class="modal-body" id="notificationList">
                            <!-- 未读消息将在这里显示 -->
                        </div>
                    </div>
                </div>

                <!-- 更多选项对话框 -->
                <div class="modal" id="moreModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>更多选项</h3>
                            <button class="close-btn" onclick="closeMoreModal()">×</button>
                        </div>
                        <div class="modal-body">
                            <div class="more-options">
                                <button class="option-btn" onclick="openRoleGroupMomentsDialog()">
                                    角色分组发布朋友圈
                                </button>
                                <button class="option-btn" onclick="openAutoMomentsDialog()">
                                    自动生成朋友圈
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 角色分组发布朋友圈对话框 -->
                <div class="modal" id="roleGroupMomentsModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>角色分组发布朋友圈</h3>
                            <button class="close-btn" onclick="closeRoleGroupMomentsDialog()">×</button>
                        </div>
                        <div class="modal-body">
                            <!-- 分组选择 -->
                            <div class="group-select">
                                <label>选择分组：</label>
                                <select id="roleGroupSelect">
                                    <option value="">请选择分组</option>
                                </select>
                            </div>
                            
                            <!-- 角色列表 -->
                            <div style="margin-top:15px;">
                                <label style="display:block;margin-bottom:8px;font-size:14px;color:#333;">选择角色（支持多选）：</label>
                                <div id="roleGroupCharacterList" style="min-height:100px;border:1px solid #ddd;border-radius:4px;padding:8px;background:#f9f9f9;">
                                    <div style="color:#999;padding:20px;text-align:center;">请先选择分组</div>
                                </div>
                            </div>
                            
                            <!-- 提示信息 -->
                            <div style="margin-top:15px;padding:12px;background:#f0f8ff;border-left:3px solid #0099ff;border-radius:4px;font-size:13px;color:#333;">
                                <i class="fas fa-info-circle" style="color:#0099ff;margin-right:8px;"></i>
                                <span>朋友圈内容将由选中的角色自动生成</span>
                            </div>
                            
                            <!-- 按钮区 -->
                            <div class="modal-actions" style="margin-top:15px;">
                                <button class="submit-btn" onclick="publishRoleGroupMoment()">发布</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 自动生成朋友圈对话框 -->
                <div class="modal" id="autoMomentsModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>自动生成朋友圈</h3>
                            <button class="close-btn" onclick="closeAutoMomentsDialog()">×</button>
                        </div>
                        <div class="modal-body">
                            <!-- 分组选择 -->
                            <div class="group-select">
                                <label style="display:block;margin-bottom:8px;font-size:14px;color:#333;">选择分组（支持多选）：</label>
                                <div id="autoMomentsGroupList" style="min-height:100px;border:1px solid #ddd;border-radius:4px;padding:8px;background:#f9f9f9;max-height:200px;overflow-y:auto;">
                                    <div style="color:#999;padding:20px;text-align:center;">加载中...</div>
                                </div>
                            </div>
                            
                            <!-- 角色列表 -->
                            <div style="margin-top:15px;">
                                <label style="display:block;margin-bottom:8px;font-size:14px;color:#333;">选择角色（支持多选）：</label>
                                <div id="autoMomentsCharacterList" style="min-height:100px;border:1px solid #ddd;border-radius:4px;padding:8px;background:#f9f9f9;max-height:200px;overflow-y:auto;">
                                    <div style="color:#999;padding:20px;text-align:center;">请先选择分组</div>
                                </div>
                            </div>
                            
                            <!-- 提示信息 -->
                            <div style="margin-top:15px;padding:12px;background:#fff3cd;border-left:3px solid #ffc107;border-radius:4px;font-size:13px;color:#333;">
                                <i class="fas fa-lightbulb" style="color:#ffc107;margin-right:8px;"></i>
                                <span>选中的角色在与你聊天时，会根据对话内容主动发朋友圈</span>
                            </div>
                            
                            <!-- 按钮区 -->
                            <div class="modal-actions" style="margin-top:15px;">
                                <button class="submit-btn" onclick="saveAutoMomentsSettings()">保存设置</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 评论/回复对话框 -->
                <div class="modal" id="commentModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>评论</h3>
                            <button class="close-btn" onclick="closeCommentModal()">×</button>
                        </div>
                        <div class="modal-body">
                            <div class="comment-thread" id="commentThread">
                                <!-- 评论将在这里显示 -->
                            </div>
                            <div class="comment-input-box">
                                <textarea id="commentInputText" placeholder="输入评论..."></textarea>
                                <button class="submit-btn" onclick="submitComment()">发送</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 删除确认弹窗 -->
                <div class="confirm-modal" id="deleteConfirmModal">
                    <div class="confirm-content">
                        <div class="confirm-title">确认删除</div>
                        <div class="confirm-message">确定要删除这条朋友圈吗？删除后将无法恢复。</div>
                        <div class="confirm-buttons">
                            <button class="confirm-btn confirm-btn-cancel" onclick="closeDeleteConfirm()">取消</button>
                            <button class="confirm-btn confirm-btn-delete" onclick="confirmDelete()">删除</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 子页面 - 论坛 -->
        <div class="sub-page" id="forum-page">
            <div class="sub-nav">
                <div class="back-btn" data-back="forum-page">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">论坛</div>
            </div>
            <div class="sub-content">
                <div class="placeholder-text">
                    【论坛功能开发中】
                </div>
            </div>
        </div>

                <!-- 子页面 - 阅读 -->
        <div class="sub-page" id="reading-page">
            <div class="sub-nav">
                <div class="back-btn" data-back="reading-page">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">阅读</div>
            </div>
            <div class="sub-content">
                <div class="placeholder-text">
                    【阅读功能开发中】
                </div>
            </div>
        </div>

        <!-- 子页面 - 日历 -->
        <div class="sub-page" id="calendar-page">
            <div class="sub-nav">
                <div class="back-btn" data-back="calendar-page">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">日历</div>
            </div>
            <div class="sub-content">
                <div class="placeholder-text">
                    【日历功能开发中】
                </div>
            </div>
        </div>

        <!-- 天气页面 -->
<div class="sub-page" id="weather-page">
    <div class="sub-nav">
        <div class="back-btn" data-back="weather-page">
            <div class="back-arrow"></div>
            <span>返回</span>
        </div>
        <div class="sub-title">天气</div>
    </div>
    <div class="sub-content">
        <div class="placeholder-text">
            【天气功能开发中】
        </div>
    </div>
</div>


        <!-- 购物页面 -->
<div class="sub-page" id="shopping-page">
    <div class="sub-content">
        <!-- 主购物页面 -->
        <div class="shopping-main-content active">
            <!-- 顶部搜索栏 -->
            <div class="shopping-header">
                <div class="shopping-back-btn back-btn" data-back="shopping-page">
                    <i class="fa fa-arrow-left"></i>
                </div>
                <div class="shopping-search-box">
                    <i class="fa fa-search"></i>
                    <input type="text" placeholder="淘宝热搜 年货节特惠" id="shopping-search-input" readonly>
                </div>
                <div class="shopping-generate-btn" id="shopping-generate-btn">
                    <i class="fa fa-magic"></i>
                    <span>生成</span>
                </div>
            </div>

            <!-- 分类导航：8入口全显，4列换行 -->
            <div class="category-nav">
                <div class="category-item">
                    <div class="icon"><i class="fa fa-utensils"></i></div>
                    <div class="text">外卖</div>
                </div>
                <div class="category-item">
                    <div class="icon"><i class="fa fa-cat"></i></div>
                    <div class="text">天猫</div>
                </div>
                <div class="category-item">
                    <div class="icon"><i class="fa fa-fire"></i></div>
                    <div class="text">聚划算</div>
                </div>
                <div class="category-item">
                    <div class="icon"><i class="fa fa-store"></i></div>
                    <div class="text">超市</div>
                </div>
                <div class="category-item">
                    <div class="icon"><i class="fa fa-video"></i></div>
                    <div class="text">直播</div>
                </div>
                <div class="category-item">
                    <div class="icon"><i class="fa fa-gift"></i></div>
                    <div class="text">红包</div>
                </div>
                <div class="category-item">
                    <div class="icon"><i class="fa fa-user"></i></div>
                    <div class="text">我的</div>
                </div>
                <div class="category-item">
                    <div class="icon"><i class="fa fa-th"></i></div>
                    <div class="text">分类</div>
                </div>
            </div>

            <!-- 外卖闪购 -->
            <div class="flash-buy">
                <div class="title">
                    <div class="left">
                        <i class="fa fa-bolt"></i>
                        <span>外卖闪购</span>
                        <span class="time">30分钟达</span>
                    </div>
                    <div class="more">查看更多 ></div>
                </div>
                <div class="content">
                    <div class="flash-item">
                        <img src="https://image.uglycat.cc/bohbfr.jpg" alt="闪购商品">
                        <div class="name">水果生鲜组合</div>
                        <div class="price">¥29.9</div>
                    </div>
                    <div class="flash-item">
                        <img src="https://image.uglycat.cc/z8slpz.jpg" alt="闪购商品">
                        <div class="name">网红零食大礼包</div>
                        <div class="price">¥19.9</div>
                    </div>
                    <div class="flash-item">
                        <img src="https://image.uglycat.cc/ifsblu.jpg" alt="闪购商品">
                        <div class="name">日用百货</div>
                        <div class="price">¥9.9</div>
                    </div>
                </div>
            </div>

            <!-- 商品列表 -->
            <div class="goods-list">
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/zf3m8m.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">新款纯棉短袖t恤女夏季宽松百搭显瘦圆领上衣ins潮</div>
                        <div class="price">¥39.9 <span class="sales">月销10w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/17h4rj.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">无线蓝牙耳机半入耳式高音质降噪适用于苹果华为小米</div>
                        <div class="price">¥89 <span class="sales">月销5w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/2zwfed.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">家用保温杯316不锈钢大容量便携男女学生水杯刻字</div>
                        <div class="price">¥29.9 <span class="sales">月销8w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/nyq7xs.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">网红ins风餐具套装陶瓷碗盘筷家用高颜值乔迁新居送礼</div>
                        <div class="price">¥59 <span class="sales">月销3w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/z9473r.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">夏季冰丝阔腿裤女高腰垂感显瘦直筒宽松休闲拖地裤</div>
                        <div class="price">¥49.9 <span class="sales">月销15w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/otacqh.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">迷你小风扇便携式手持usb充电静音桌面宿舍随身电风扇</div>
                        <div class="price">¥19.9 <span class="sales">月销20w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/3uw23x.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">智能手环运动手表多功能计步心率监测防水男女通用</div>
                        <div class="price">¥79 <span class="sales">月销12w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/9vjkk9.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">北欧风格简约现代客厅装饰画沙发背景墙挂画三联画</div>
                        <div class="price">¥99 <span class="sales">月销6w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/pwg6qp.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">儿童益智玩具积木拼装男孩女孩早教启蒙礼物3-6岁</div>
                        <div class="price">¥45.9 <span class="sales">月销18w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/tsgtxx.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">真皮钱包男士短款头层牛皮横款多卡位驾驶证一体包</div>
                        <div class="price">¥68 <span class="sales">月销9w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/e9skct.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">办公室桌面收纳盒塑料化妆品整理盒抽屉式储物盒</div>
                        <div class="price">¥25.9 <span class="sales">月销25w+</span></div>
                    </div>
                </div>
                <div class="goods-card">
                    <img src="https://image.uglycat.cc/hm9xpd.jpg" alt="商品">
                    <div class="desc">
                        <div class="name">高清投影仪家用小型便携式手机同屏无线wifi智能</div>
                        <div class="price">¥299 <span class="sales">月销4w+</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 分类页面 -->
        <div class="category-page">
            <div class="category-content">
                <div class="category-left">
                    <div class="category-left-item active" data-category="女装">女装</div>
                    <div class="category-left-item" data-category="男装">男装</div>
                    <div class="category-left-item" data-category="鞋包">鞋包</div>
                    <div class="category-left-item" data-category="美妆">美妆</div>
                    <div class="category-left-item" data-category="数码">数码</div>
                    <div class="category-left-item" data-category="家电">家电</div>
                    <div class="category-left-item" data-category="食品">食品</div>
                    <div class="category-left-item" data-category="家居">家居</div>
                    <div class="category-left-item" data-category="母婴">母婴</div>
                    <div class="category-left-item" data-category="运动">运动</div>
                </div>
                <div class="category-right">
                    <div class="category-header">
                        <div class="category-goods-title" id="category-goods-title">女装</div>
                        <div class="category-generate-btn" id="category-generate-btn">
                            <i class="fas fa-magic"></i>
                            <span>生成</span>
                        </div>
                    </div>
                    <div class="category-goods-grid" id="category-goods-grid">
                        <!-- 商品卡片将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 购物车页面 -->
        <div class="cart-page">
            <!-- 购物车为空状态 -->
            <div class="cart-empty" id="cart-empty">
                <i class="fa fa-shopping-cart"></i>
                <div class="text">购物车空空如也~</div>
                <div class="btn" id="cart-go-shop">去逛逛</div>
            </div>
            
            <!-- 购物车商品列表 -->
            <div class="cart-content" id="cart-content" style="display: none;">
                <!-- 商品列表容器 -->
                <div class="cart-list" id="cart-list"></div>
            </div>
            
            <!-- 购物车底部结算栏 -->
            <div class="cart-footer" id="cart-footer">
                <div class="cart-footer-check">
                    <div class="cart-check" id="cart-all-check"></div>
                    <div class="cart-footer-text">全选</div>
                </div>
                <div class="cart-footer-right">
                    <div class="cart-footer-price">
                        <span class="cart-footer-label">合计：</span>
                        <span class="cart-footer-money" id="cart-total-price">¥0.00</span>
                    </div>
                    <div class="cart-footer-pay" id="cart-settle-btn">结算</div>
                </div>
            </div>
        </div>

        <!-- 地址管理页面 -->
        <div class="address-manage-page" id="address-manage-page">
            <div class="address-header">
                <div class="address-back-btn" id="address-back-btn">
                    <i class="fa fa-chevron-left"></i>
                </div>
                <div class="address-header-title">地址管理</div>
                <div class="address-header-right"></div>
            </div>
            
            <div class="address-content">
                <!-- 地址列表 -->
                <div class="address-list" id="address-list"></div>
                
                <!-- 空状态 -->
                <div class="address-empty" id="address-empty">
                    <i class="fa fa-map-marker-alt"></i>
                    <div class="address-empty-text">暂无收货地址</div>
                </div>
            </div>
            
            <!-- 添加地址按钮 -->
            <div class="address-add-btn" id="address-add-btn">
                <i class="fa fa-plus"></i> 新增收货地址
            </div>
        </div>

        <!-- 地址编辑页面 -->
        <div class="address-edit-page" id="address-edit-page">
            <div class="address-header">
                <div class="address-back-btn" id="address-edit-back-btn">
                    <i class="fa fa-chevron-left"></i>
                </div>
                <div class="address-header-title" id="address-edit-title">新增地址</div>
                <div class="address-header-right"></div>
            </div>
            
            <div class="address-edit-content">
                <div class="address-form">
                    <div class="address-form-item">
                        <div class="address-form-label">收货人</div>
                        <input type="text" class="address-form-input" id="address-name" placeholder="请输入收货人姓名">
                    </div>
                    <div class="address-form-item">
                        <div class="address-form-label">手机号</div>
                        <input type="tel" class="address-form-input" id="address-phone" placeholder="请输入手机号码">
                    </div>
                    <div class="address-form-item">
                        <div class="address-form-label">所在地区</div>
                        <input type="text" class="address-form-input" id="address-region" placeholder="省/市/区">
                    </div>
                    <div class="address-form-item">
                        <div class="address-form-label">详细地址</div>
                        <textarea class="address-form-textarea" id="address-detail" placeholder="街道、楼牌号等"></textarea>
                    </div>
                    <div class="address-form-item address-form-switch">
                        <div class="address-form-label">设为默认地址</div>
                        <div class="address-switch" id="address-default-switch">
                            <div class="address-switch-btn"></div>
                        </div>
                    </div>
                </div>
                
                <div class="address-save-btn" id="address-save-btn">保存</div>
                <div class="address-delete-btn" id="address-delete-btn" style="display: none;">删除地址</div>
            </div>
        </div>

        <!-- 我的页面 -->
        <div class="mine-page">
            <div class="mine-top">
                <div class="mine-user">
                    <div class="mine-avatar" id="mine-avatar-display">
                        <img src="https://picsum.photos/55/55?random=50" alt="头像" id="mine-avatar-img">
                    </div>
                    <div class="mine-info">
                        <div class="mine-name" id="mine-name-display">淘宝用户123456</div>
                        <div class="mine-id" id="mine-id-display">ID: 1234567890</div>
                    </div>
                    <div class="mine-set" id="mine-edit-btn"><i class="fa fa-edit"></i></div>
                </div>
                <div class="mine-data">
                    <div class="mine-data-item">
                        <div class="mine-data-num" id="mine-follow-num">0</div>
                        <div class="mine-data-text">关注</div>
                    </div>
                    <div class="mine-data-item">
                        <div class="mine-data-num" id="mine-fans-num">12</div>
                        <div class="mine-data-text">粉丝</div>
                    </div>
                    <div class="mine-data-item">
                        <div class="mine-data-num">28</div>
                        <div class="mine-data-text">收藏</div>
                    </div>
                    <div class="mine-data-item">
                        <div class="mine-data-num">100</div>
                        <div class="mine-data-text">积分</div>
                    </div>
                </div>
            </div>
            <div class="mine-order">
                <div class="mine-order-top">
                    <div class="mine-order-title">我的订单</div>
                    <div class="mine-order-more">查看全部 ></div>
                </div>
                <div class="mine-order-list">
                    <div class="mine-order-item">
                        <i class="fa fa-list"></i>
                        <div class="text">全部</div>
                    </div>
                    <div class="mine-order-item">
                        <i class="fa fa-credit-card"></i>
                        <div class="text">待付款</div>
                    </div>
                    <div class="mine-order-item">
                        <i class="fa fa-truck"></i>
                        <div class="text">待发货</div>
                    </div>
                    <div class="mine-order-item">
                        <i class="fa fa-box"></i>
                        <div class="text">待收货</div>
                    </div>
                    <div class="mine-order-item">
                        <i class="fa fa-star"></i>
                        <div class="text">待评价</div>
                    </div>
                </div>
            </div>
            <div class="mine-menu">
                <div class="mine-menu-item">
                    <div class="mine-menu-icon"><i class="fa fa-gift"></i></div>
                    <div class="mine-menu-text">我的红包</div>
                    <div class="mine-menu-arrow"><i class="fa fa-chevron-right"></i></div>
                </div>
                <div class="mine-menu-item">
                    <div class="mine-menu-icon"><i class="fa fa-ticket-alt"></i></div>
                    <div class="mine-menu-text">我的优惠券</div>
                    <div class="mine-menu-arrow"><i class="fa fa-chevron-right"></i></div>
                </div>
                <div class="mine-menu-item">
                    <div class="mine-menu-icon"><i class="fa fa-heart"></i></div>
                    <div class="mine-menu-text">我的收藏</div>
                    <div class="mine-menu-arrow"><i class="fa fa-chevron-right"></i></div>
                </div>
                <div class="mine-menu-item">
                    <div class="mine-menu-icon"><i class="fa fa-map-marker-alt"></i></div>
                    <div class="mine-menu-text">我的地址</div>
                    <div class="mine-menu-arrow"><i class="fa fa-chevron-right"></i></div>
                </div>
            </div>
            <div class="mine-menu">
                <div class="mine-menu-item">
                    <div class="mine-menu-icon"><i class="fa fa-headset"></i></div>
                    <div class="mine-menu-text">客服中心</div>
                    <div class="mine-menu-arrow"><i class="fa fa-chevron-right"></i></div>
                </div>
                <div class="mine-menu-item">
                    <div class="mine-menu-icon"><i class="fa fa-cog"></i></div>
                    <div class="mine-menu-text">设置</div>
                    <div class="mine-menu-arrow"><i class="fa fa-chevron-right"></i></div>
                </div>
            </div>
        </div>
        
        <!-- 用户信息编辑弹窗 -->
        <div class="mine-edit-modal" id="mine-edit-modal">
            <div class="mine-edit-content">
                <div class="mine-edit-header">
                    <div class="mine-edit-title">编辑个人信息</div>
                    <div class="mine-edit-close" id="mine-edit-close"><i class="fa fa-times"></i></div>
                </div>
                <div class="mine-edit-body">
                    <div class="mine-edit-item">
                        <div class="mine-edit-label">头像</div>
                        <div class="mine-edit-avatar-wrapper">
                            <img src="https://picsum.photos/55/55?random=50" alt="头像" id="mine-edit-avatar-preview">
                            <div class="mine-edit-avatar-btn" id="mine-edit-avatar-btn">
                                <i class="fa fa-camera"></i>
                            </div>
                        </div>
                        <input type="text" class="mine-edit-input" id="mine-edit-avatar-input" placeholder="输入头像URL">
                    </div>
                    <div class="mine-edit-item">
                        <div class="mine-edit-label">用户名</div>
                        <input type="text" class="mine-edit-input" id="mine-edit-name-input" placeholder="输入用户名">
                    </div>
                    <div class="mine-edit-item">
                        <div class="mine-edit-label">淘宝ID</div>
                        <input type="text" class="mine-edit-input" id="mine-edit-id-input" placeholder="输入淘宝ID">
                    </div>
                    <div class="mine-edit-item">
                        <div class="mine-edit-label">关注数量</div>
                        <input type="number" class="mine-edit-input" id="mine-edit-follow-input" placeholder="输入关注数量" min="0">
                    </div>
                    <div class="mine-edit-item">
                        <div class="mine-edit-label">粉丝数量</div>
                        <input type="number" class="mine-edit-input" id="mine-edit-fans-input" placeholder="输入粉丝数量" min="0">
                    </div>
                </div>
                <div class="mine-edit-footer">
                    <div class="mine-edit-btn-cancel" id="mine-edit-btn-cancel">取消</div>
                    <div class="mine-edit-btn-save" id="mine-edit-btn-save">保存</div>
                </div>
            </div>
        </div>

        <!-- 订单列表页面 -->
        <div class="order-list-page" id="order-list-page">
            <div class="order-list-header">
                <div class="order-list-back-btn" id="order-list-back-btn">
                    <i class="fa fa-arrow-left"></i>
                </div>
                <div class="order-list-title">我的订单</div>
            </div>
            
            <!-- 订单状态标签 -->
            <div class="order-list-tabs">
                <div class="order-list-tab active" data-status="all">全部</div>
                <div class="order-list-tab" data-status="unpaid">待付款</div>
                <div class="order-list-tab" data-status="unshipped">待发货</div>
                <div class="order-list-tab" data-status="shipped">待收货</div>
                <div class="order-list-tab" data-status="completed">已完成</div>
            </div>
            
            <!-- 订单列表内容 -->
            <div class="order-list-content" id="order-list-content">
                <!-- 订单为空状态 -->
                <div class="order-list-empty" id="order-list-empty">
                    <i class="fa fa-clipboard-list"></i>
                    <div class="text">暂无订单</div>
                </div>
                
                <!-- 订单列表容器 -->
                <div class="order-items-container" id="order-items-container"></div>
            </div>
        </div>
        
        <!-- 订单详情页面 -->
        <div class="order-detail-page" id="order-detail-page">
            <div class="order-detail-header">
                <div class="order-detail-back-btn" id="order-detail-back-btn">
                    <i class="fa fa-arrow-left"></i>
                </div>
                <div class="order-detail-title">订单详情</div>
            </div>
            
            <div class="order-detail-content">
                <!-- 订单状态 -->
                <div class="order-detail-status" id="order-detail-status">
                    <div class="order-detail-status-icon">
                        <i class="fa fa-check-circle"></i>
                    </div>
                    <div class="order-detail-status-text">
                        <div class="status-main" id="status-main-text">交易成功</div>
                        <div class="status-sub" id="status-sub-text">感谢您的购买</div>
                    </div>
                </div>
                
                <!-- 物流信息 -->
                <div class="order-detail-logistics" id="order-detail-logistics">
                    <div class="logistics-header">
                        <div class="logistics-title">
                            <i class="fa fa-truck"></i> 物流信息
                        </div>
                    </div>
                    <div class="logistics-info" id="logistics-info">
                        <div class="logistics-company">快递公司：<span id="logistics-company-name">圆通速递</span></div>
                        <div class="logistics-no">运单编号：<span id="logistics-tracking-no">YT1234567890</span></div>
                    </div>
                </div>
                
                <!-- 收货地址 -->
                <div class="order-detail-address" id="order-detail-address">
                    <div class="address-header">
                        <i class="fa fa-map-marker-alt"></i> 收货信息
                    </div>
                    <div class="address-info">
                        <div class="address-name-phone">
                            <span id="detail-address-name">张三</span>
                            <span id="detail-address-phone">138****5678</span>
                        </div>
                        <div class="address-detail" id="detail-address-text">
                            浙江省杭州市西湖区文三路123号
                        </div>
                    </div>
                </div>
                
                <!-- 商品信息 -->
                <div class="order-detail-goods">
                    <div class="goods-header">
                        <i class="fa fa-store"></i> 淘宝店铺
                    </div>
                    <div class="goods-list" id="order-detail-goods-list"></div>
                </div>
                
                <!-- 订单信息 -->
                <div class="order-detail-info">
                    <div class="info-row">
                        <span class="info-label">订单编号</span>
                        <span class="info-value" id="detail-order-no">2024010112345678</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">下单时间</span>
                        <span class="info-value" id="detail-order-time">2024-01-01 12:00:00</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">支付方式</span>
                        <span class="info-value" id="detail-payment-method">支付宝</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">商品金额</span>
                        <span class="info-value" id="detail-goods-amount">¥0.00</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">运费</span>
                        <span class="info-value" id="detail-freight">¥0.00</span>
                    </div>
                    <div class="info-row total">
                        <span class="info-label">实付款</span>
                        <span class="info-value" id="detail-total-amount">¥0.00</span>
                    </div>
                </div>
            </div>
            
            <!-- 底部操作按钮 -->
            <div class="order-detail-footer" id="order-detail-footer">
                <div class="order-detail-btn" id="detail-delete-btn">删除订单</div>
                <div class="order-detail-btn primary" id="detail-confirm-btn">确认收货</div>
            </div>
        </div>
        
        <!-- 确认订单页面 -->
        <div class="order-confirm-page" id="order-confirm-page">
            <div class="order-header">
                <div class="order-back-btn" id="order-back-btn">
                    <i class="fa fa-arrow-left"></i>
                </div>
                <div class="order-title">确认订单</div>
            </div>
            
            <div class="order-content">
                <!-- 收货地址 -->
                <div class="order-address" id="order-address">
                    <div class="order-address-add" id="add-address-btn">
                        <i class="fa fa-plus-circle"></i>
                        <span>添加收货地址</span>
                    </div>
                </div>
                
                <!-- 商品列表 -->
                <div class="order-goods">
                    <div class="order-section-title">
                        <i class="fa fa-store"></i> 淘宝店铺
                    </div>
                    <div class="order-goods-list" id="order-goods-list"></div>
                </div>
                
                <!-- 优惠券 -->
                <div class="order-coupon">
                    <div class="order-coupon-label">店铺优惠券</div>
                    <div class="order-coupon-select">
                        <span>暂无可用</span>
                        <i class="fa fa-chevron-right"></i>
                    </div>
                </div>
                
                <!-- 配送方式 -->
                <div class="order-delivery">
                    <div class="order-delivery-label">配送方式</div>
                    <div class="order-delivery-select">
                        <span>快递 免运费</span>
                        <i class="fa fa-chevron-right"></i>
                    </div>
                </div>
                
                <!-- 买家留言 -->
                <div class="order-message">
                    <div class="order-message-label">买家留言：</div>
                    <input type="text" class="order-message-input" id="order-message-input" placeholder="选填，请先和商家协商一致">
                </div>
                
                <!-- 商品金额 -->
                <div class="order-amount">
                    <div class="order-amount-item">
                        <span>商品金额</span>
                        <span id="order-goods-amount">¥0.00</span>
                    </div>
                    <div class="order-amount-item">
                        <span>运费</span>
                        <span id="order-freight">¥0.00</span>
                    </div>
                </div>
            </div>
            
            <!-- 底部支付栏 -->
            <div class="order-footer">
                <div class="order-footer-price">
                    <span>实付款：</span>
                    <span class="order-footer-money" id="order-total-price">¥0.00</span>
                </div>
                <div class="order-footer-btn" id="order-submit-btn">提交订单</div>
            </div>
        </div>
        
        <!-- 支付页面 -->
        <div class="payment-page" id="payment-page">
            <div class="payment-header">
                <div class="payment-back-btn" id="payment-back-btn">
                    <i class="fa fa-arrow-left"></i>
                </div>
                <div class="payment-title">收银台</div>
            </div>
            
            <div class="payment-content">
                <!-- 订单信息 -->
                <div class="payment-order-info">
                    <div class="payment-amount">
                        <div class="payment-amount-label">订单金额</div>
                        <div class="payment-amount-money" id="payment-amount">¥0.00</div>
                    </div>
                    <div class="payment-order-no">
                        订单编号：<span id="payment-order-no"></span>
                    </div>
                </div>
                
                <!-- 支付方式 -->
                <div class="payment-methods">
                    <div class="payment-method-title">选择支付方式</div>
                    <div class="payment-method-item active" data-method="balance">
                        <div class="payment-method-icon" style="color: #FF6600;">
                            <i class="fa fa-wallet"></i>
                        </div>
                        <div class="payment-method-name">余额支付（喵币）</div>
                        <div class="payment-method-desc" id="payment-balance-display">余额：¥0.00</div>
                        <div class="payment-method-check">
                            <i class="fa fa-check-circle"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 底部支付按钮 -->
            <div class="payment-footer">
                <div class="payment-footer-btn" id="payment-confirm-btn">
                    确认支付 <span id="payment-final-amount">¥0.00</span>
                </div>
            </div>
        </div>

        <!-- 商品详情页面 -->
        <div class="goods-detail-page" id="goods-detail-page">
            <div class="goods-detail-header">
                <div class="goods-detail-back" id="goods-detail-back">
                    <i class="fa fa-arrow-left"></i>
                </div>
                <div class="goods-detail-title">商品详情</div>
                <div class="goods-detail-share">
                    <i class="fa fa-share-alt"></i>
                </div>
            </div>
            
            <div class="goods-detail-content">
                <div class="goods-detail-image">
                    <img id="goods-detail-img" src="" alt="商品图片">
                </div>
                
                <div class="goods-detail-info">
                    <div class="goods-detail-price-box">
                        <div class="goods-detail-price" id="goods-detail-price">¥0.00</div>
                        <div class="goods-detail-sales" id="goods-detail-sales">月销0</div>
                    </div>
                    <div class="goods-detail-name" id="goods-detail-name">商品名称</div>
                    <div class="goods-detail-desc-title">商品描述</div>
                    <div class="goods-detail-desc" id="goods-detail-desc">商品详细描述</div>
                </div>
            </div>
            
            <div class="goods-detail-footer">
                <div class="goods-detail-btn goods-detail-btn-cart" id="goods-detail-add-cart">
                    <i class="fa fa-shopping-cart"></i>
                    <span>加入购物车</span>
                </div>
                <div class="goods-detail-btn goods-detail-btn-forward" id="goods-detail-forward">
                    <i class="fa fa-share"></i>
                    <span>转发给好友</span>
                </div>
            </div>
        </div>

        <!-- 转发选择角色弹窗 -->
        <div class="forward-modal" id="forward-modal">
            <div class="forward-modal-content">
                <div class="forward-modal-header">
                    <div class="forward-modal-title">选择转发对象</div>
                    <div class="forward-modal-close" id="forward-modal-close">
                        <i class="fa fa-times"></i>
                    </div>
                </div>
                <div class="forward-modal-search">
                    <i class="fa fa-search"></i>
                    <input type="text" placeholder="搜索好友" id="forward-search-input">
                </div>
                <div class="forward-modal-list" id="forward-modal-list">
                    <!-- 好友列表将动态生成 -->
                </div>
            </div>
        </div>

        <!-- 底部导航栏 -->
        <div class="shopping-footer">
            <div class="shopping-footer-item active" data-tab="home">
                <i class="fa fa-home"></i>
                <span>首页</span>
            </div>
            <div class="shopping-footer-item" data-tab="category">
                <i class="fa fa-th"></i>
                <span>分类</span>
            </div>
            <div class="shopping-footer-item" data-tab="cart">
                <i class="fa fa-shopping-cart"></i>
                <span>购物车</span>
            </div>
            <div class="shopping-footer-item" data-tab="mine">
                <i class="fa fa-user"></i>
                <span>我的</span>
            </div>
        </div>
    </div>
</div>

        <!-- 子页面 - 游戏中心 -->
        <div class="sub-page" id="game-page">
            <div class="sub-nav">
                <div class="back-btn" data-back="game-page">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">游戏中心</div>
            </div>
            <div class="sub-content">
                <div class="placeholder-text">
                    【游戏中心开发中】
                </div>
            </div>
        </div>

        <!-- 子页面 - 默契大挑战 -->
        <div class="sub-page" id="tacit-page">
            <div class="sub-nav">
                <div class="back-btn" data-back="tacit-page">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">默契大挑战</div>
            </div>
            <div class="sub-content">
                <div class="placeholder-text">
                    等待开发中
                </div>
            </div>
        </div>

        <!-- 子页面 - 心灵星系 -->
        <div class="sub-page" id="spirit-galaxy-page">
            <div class="sub-nav">
                <div class="back-btn" data-back="spirit-galaxy-page">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">心灵星系</div>
            </div>
            <div class="sub-content">
                <div class="placeholder-text">
                    等待开发中
                </div>
            </div>
        </div>

        <!-- 子页面 - 灵感库 -->
        <div class="sub-page" id="idea-library-page">
            <div class="sub-nav">
                <div class="back-btn" data-back="idea-library-page">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">灵感库</div>
            </div>
            <div class="sub-content">
                <div class="placeholder-text">
                    等待开发中
                </div>
            </div>
        </div>

        <!-- 子页面 - 观察者 -->
        <div class="sub-page" id="third-party-page">
            <div class="sub-nav">
                <div class="back-btn" data-back="third-party-page">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">观察者</div>
            </div>
            <div class="sub-content">
                <div class="placeholder-text">
                    等待开发中
                </div>
            </div>
        </div>

        <!-- 子页面 - API设置 -->
        <div class="sub-page" id="api-settings-page">
            <div class="sub-nav">
                <div class="back-btn" data-back="api-settings-page">
                    <span>返回</span>
                </div>
                <div class="sub-title">API设置</div>
            </div>
            <div class="sub-content">
                <div class="api-settings-container">
                    <!-- API预设管理 -->
                    <div class="settings-card">
                        <h3 class="card-title">
                            <span class="title-indicator"></span>
                            API 预设管理
                        </h3>
                        <button id="api-preset-btn" class="modern-btn" style="width:100%;">预设管理</button>
                    </div>

                    <!-- 主API设置 -->
                    <div class="settings-card">
                        <h3 class="card-title">
                            <span class="title-indicator"></span>
                            主API设置
                        </h3>
                        
                        <div class="setting-row">
                            <label class="modern-label">API 端点 (Endpoint)</label>
                            <input id="api-endpoint" class="modern-input" placeholder="例如 https://api.openai.com/v1">
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">API 密钥 (Key)</label>
                            <div style="display:flex;gap:10px;align-items:center;">
                                <input id="api-key" class="modern-input" type="text" placeholder="在此处填写 Bearer Key（可选）" style="flex:1;">
                                <button id="api-key-toggle" class="modern-btn modern-btn-small">显示</button>
                            </div>
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">拉取模型</label>
                            <button id="pull-models-btn" class="modern-btn" style="width:100%;">拉取模型</button>
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">模型名称</label>
                            <select id="models-select" class="modern-select" style="margin-top:8px;"></select>
                            <div class="info-box">目前保存的模型：<span id="selected-model-display" class="highlight">未选择</span></div>
                        </div>
                    </div>
                    
                    <!-- 副API设置 -->
                    <div class="settings-card">
                        <h3 class="card-title">
                            <span class="title-indicator"></span>
                            副API设置（用于翻译、总结等）
                        </h3>
                        
                        <div class="setting-row">
                            <label class="modern-label">副API 端点 (Endpoint)</label>
                            <input id="secondary-api-endpoint" class="modern-input" placeholder="例如 https://api.example.com/v1">
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">副API 密钥 (Key)</label>
                            <div style="display:flex;gap:10px;align-items:center;">
                                <input id="secondary-api-key" class="modern-input" type="text" placeholder="副API密钥（可选）" style="flex:1;">
                                <button id="secondary-api-key-toggle" class="modern-btn modern-btn-small">显示</button>
                            </div>
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">拉取模型</label>
                            <button id="pull-secondary-models-btn" class="modern-btn" style="width:100%;">拉取模型</button>
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">模型名称</label>
                            <select id="secondary-models-select" class="modern-select" style="margin-top:8px;"></select>
                            <div class="info-box">目前保存的模型：<span id="secondary-selected-model-display" class="highlight">未选择</span></div>
                        </div>
                    </div>

                    <!-- 主API参数设置 -->
                    <div style="margin-bottom:20px;padding:18px;background:#ffffff;border-radius:12px;border:1px solid #e8e8e8;box-shadow:0 1px 3px rgba(0,0,0,0.05);">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
                            <h3 style="margin:0;font-size:16px;color:#555;font-weight:600;display:flex;align-items:center;gap:8px;">
                                <span style="display:inline-block;width:3px;height:16px;background:#999;border-radius:2px;"></span>
                                主API参数设置
                            </h3>
                            <button id="api-params-lock-btn" class="small-btn" style="padding:6px 12px;height:32px;font-size:13px;display:flex;align-items:center;gap:6px;">
                                <i class="fa-solid fa-lock-open"></i>
                                <span>解锁</span>
                            </button>
                        </div>
                        <div id="api-params-container" style="opacity:1;transition:opacity 0.3s;">
                        
                        <div class="setting-row">
                            <label class="setting-label" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                <span>温度 (Temperature)</span>
                                <span id="temperature-value" style="color:#666;font-weight:600;font-size:14px;background:#f5f5f5;padding:4px 10px;border-radius:6px;">0.8</span>
                            </label>
                            <input id="temperature-input" type="range" min="0" max="2" step="0.01" value="0.8" style="width:100%;height:6px;border-radius:3px;outline:none;-webkit-appearance:none;background:linear-gradient(90deg,#e8e8e8,#ccc);cursor:pointer;" oninput="document.getElementById('temperature-value').textContent = this.value">
                            <div style="display:flex;justify-content:space-between;margin-top:6px;color:#999;font-size:12px;">
                                <span>0 (确定性)</span>
                                <span>2 (随机性)</span>
                            </div>
                        </div>

                        <div class="setting-row">
                            <label class="setting-label" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                <span>频率惩罚 (Frequency Penalty)</span>
                                <span id="frequency-penalty-value" style="color:#666;font-weight:600;font-size:14px;background:#f5f5f5;padding:4px 10px;border-radius:6px;">0.2</span>
                            </label>
                            <input id="frequency-penalty-input" type="range" min="-2" max="2" step="0.01" value="0.2" style="width:100%;height:6px;border-radius:3px;outline:none;-webkit-appearance:none;background:linear-gradient(90deg,#e8e8e8,#ccc);cursor:pointer;" oninput="document.getElementById('frequency-penalty-value').textContent = this.value">
                            <div style="display:flex;justify-content:space-between;margin-top:6px;color:#999;font-size:12px;">
                                <span>-2 (鼓励重复)</span>
                                <span>2 (避免重复)</span>
                            </div>
                        </div>

                        <div class="setting-row">
                            <label class="setting-label" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                <span>存在惩罚 (Presence Penalty)</span>
                                <span id="presence-penalty-value" style="color:#666;font-weight:600;font-size:14px;background:#f5f5f5;padding:4px 10px;border-radius:6px;">0.1</span>
                            </label>
                            <input id="presence-penalty-input" type="range" min="-2" max="2" step="0.01" value="0.1" style="width:100%;height:6px;border-radius:3px;outline:none;-webkit-appearance:none;background:linear-gradient(90deg,#e8e8e8,#ccc);cursor:pointer;" oninput="document.getElementById('presence-penalty-value').textContent = this.value">
                            <div style="display:flex;justify-content:space-between;margin-top:6px;color:#999;font-size:12px;">
                                <span>-2 (重复话题)</span>
                                <span>2 (新话题)</span>
                            </div>
                        </div>

                        <div class="setting-row">
                            <label class="setting-label" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                <span>Top P (核采样)</span>
                                <span id="top-p-value" style="color:#666;font-weight:600;font-size:14px;background:#f5f5f5;padding:4px 10px;border-radius:6px;">1.0</span>
                            </label>
                            <input id="top-p-input" type="range" min="0" max="1" step="0.01" value="1.0" style="width:100%;height:6px;border-radius:3px;outline:none;-webkit-appearance:none;background:linear-gradient(90deg,#e8e8e8,#ccc);cursor:pointer;" oninput="document.getElementById('top-p-value').textContent = this.value">
                            <div style="display:flex;justify-content:space-between;margin-top:6px;color:#999;font-size:12px;">
                                <span>0 (保守)</span>
                                <span>1 (多样)</span>
                            </div>
                        </div>
                        </div>
                    </div>

                    <!-- MiniMax TTS 设置 -->
                    <div class="settings-card">
                        <h3 class="card-title">
                            <span class="title-indicator"></span>
                            MiniMax 语音合成 (TTS)
                        </h3>
                        
                        <div class="setting-row">
                            <label class="modern-label">启用 MiniMax TTS</label>
                            <div style="display:flex;align-items:center;gap:10px;">
                                <input type="checkbox" id="minimax-tts-enabled" style="width:18px;height:18px;cursor:pointer;accent-color:#666;">
                                <div style="color:#666;font-size:13px;">开启后角色语音将使用 MiniMax 真实语音播放</div>
                            </div>
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">Group ID</label>
                            <input id="minimax-group-id" class="modern-input" placeholder="输入 MiniMax Group ID">
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">API Key</label>
                            <div style="display:flex;gap:10px;align-items:center;">
                                <input id="minimax-api-key" class="modern-input" type="text" placeholder="输入 MiniMax API Key" style="flex:1;">
                                <button id="minimax-api-key-toggle" class="modern-btn modern-btn-small">显示</button>
                            </div>
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">声音模型 (Voice ID)</label>
                            <input id="minimax-voice-id" class="modern-input" placeholder="例如：female-tianmei" value="female-tianmei">
                            <div style="margin-top:8px;padding:10px;background:#f9f9f9;border-radius:6px;font-size:12px;color:#666;">
                                常用声音：female-tianmei (甜美女声), male-qn-qingse (青涩男声), female-shaonv (少女), male-qn-jingying (精英男声)
                            </div>
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">语速</label>
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                <span style="font-size:13px;color:#666;">Speed</span>
                                <span id="minimax-speed-value" style="color:#666;font-weight:600;font-size:14px;background:#f5f5f5;padding:4px 10px;border-radius:6px;">1.0</span>
                            </div>
                            <input id="minimax-speed-input" type="range" min="0.5" max="2.0" step="0.1" value="1.0" style="width:100%;height:6px;border-radius:3px;outline:none;-webkit-appearance:none;background:linear-gradient(90deg,#e8e8e8,#ccc);cursor:pointer;" oninput="document.getElementById('minimax-speed-value').textContent = this.value">
                            <div style="display:flex;justify-content:space-between;margin-top:6px;color:#999;font-size:12px;">
                                <span>0.5 (慢)</span>
                                <span>2.0 (快)</span>
                            </div>
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">音量</label>
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                <span style="font-size:13px;color:#666;">Volume</span>
                                <span id="minimax-volume-value" style="color:#666;font-weight:600;font-size:14px;background:#f5f5f5;padding:4px 10px;border-radius:6px;">1.0</span>
                            </div>
                            <input id="minimax-volume-input" type="range" min="0.1" max="2.0" step="0.1" value="1.0" style="width:100%;height:6px;border-radius:3px;outline:none;-webkit-appearance:none;background:linear-gradient(90deg,#e8e8e8,#ccc);cursor:pointer;" oninput="document.getElementById('minimax-volume-value').textContent = this.value">
                            <div style="display:flex;justify-content:space-between;margin-top:6px;color:#999;font-size:12px;">
                                <span>0.1 (小)</span>
                                <span>2.0 (大)</span>
                            </div>
                        </div>

                        <div class="setting-row">
                            <button id="test-minimax-tts-btn" class="modern-btn" style="width:100%;">测试语音</button>
                        </div>
                    </div>

                    <!-- 其他设置 -->
                    <div class="settings-card">
                        <h3 class="card-title">
                            <span class="title-indicator"></span>
                            其他设置
                        </h3>
                        
                        <div class="setting-row">
                            <label class="modern-label">AI 时间感知</label>
                            <div style="display:flex;align-items:center;gap:10px;">
                                <input type="checkbox" id="ai-time-aware" checked style="width:18px;height:18px;cursor:pointer;accent-color:#666;">
                                <div style="color:#666;font-size:13px;">开启后会将当前时间信息作为 system 指令发送</div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="setting-row">
                            <label class="modern-label">提示词管理</label>
                            <div style="display:flex;gap:10px;margin-top:8px;">
                                <button id="add-prompt-btn" class="modern-btn" style="flex:1;">新增提示词</button>
                                <button id="prompt-list-btn" class="modern-btn" style="flex:1;">查看提示词列表</button>
                            </div>
                        </div>

                        <div class="setting-row">
                            <label class="modern-label">当前提示词</label>
                            <select id="prompts-select" class="modern-select" style="margin-top:8px;"></select>
                            <div id="current-prompt-display" style="margin-top:12px;padding:14px;background:#fafafa;border:1px solid #e8e8e8;border-radius:10px;max-height:150px;overflow-y:auto;white-space:pre-wrap;word-wrap:break-word;font-size:12px;color:#666;font-family:monospace;line-height:1.6;"></div>
                        </div>

                        <div class="setting-row">
                            <button id="save-settings-btn" class="primary-btn-modern">保存设置</button>
                        </div>
                    </div>

                    <div class="tip-box">
                        使用说明：填写端点与（可选）密钥，点击"拉取模型"获取模型列表，务必记得点击保存设置。
                    </div>
                </div>
            </div>
        </div>

        <!-- 子页面 - 情侣空间 -->
        <div class="sub-page" id="couples-space-page">
            <div class="couples-space-container">
                <!-- 顶部导航 -->
                <div class="cs-header">
                    <button class="cs-back-btn" id="couples-space-back-btn">
                        <span>返回</span>
                    </button>
                    <div class="cs-title">情侣空间</div>
                    <button class="cs-selector-btn" onclick="CouplesSpace.openSelector()">
                        <span>切换角色</span>
                    </button>
                </div>
                
                <!-- 内容区域 -->
                <div id="couplesSpaceContent"></div>
            </div>
        </div>

        <!-- 子页面 - 钱包 -->
        <div class="sub-page" id="wallet-page">
            <div class="wallet-header">
                <div class="header-left">
                    <button class="wallet-back-btn" data-back="wallet-page">
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>
                </div>
                <span class="title">钱包</span>
                <div class="header-right">
                    <i class="fa-solid fa-gear setting-btn"></i>
                </div>
            </div>

            <div class="content-container">
                <div class="wallet-page">
                    <section class="asset-card">
                        <div class="asset-amount">
                            <span class="amount-text">喵币 <strong id="wallet-balance">0</strong></span>
                            <i class="fa-solid fa-eye-slash eye-btn" id="wallet-eye-btn"></i>
                        </div>
                        <div class="asset-desc">余额可用于兑换全站趣味权益</div>
                        <div class="asset-btns">
                            <button class="btn recharge-btn" id="wallet-recharge-btn">充值喵币</button>
                            <button class="btn trade-record-btn" id="wallet-record-btn">交易记录</button>
                        </div>
                    </section>

                    <section class="function-grid">
                        <div class="grid-item" data-func="lottery">
                            <div class="func-name-wrap">
                                <i class="fa-solid fa-gift"></i>
                                <span class="func-name">幸运大转盘</span>
                            </div>
                            <span class="func-cost">消耗 5 喵币/次</span>
                        </div>
                        <div class="grid-item" data-func="daily-fortune">
                            <div class="func-name-wrap">
                                <i class="fa-solid fa-star"></i>
                                <span class="func-name">今日运势</span>
                            </div>
                            <span class="func-cost">消耗 3 喵币/次</span>
                        </div>
                        <div class="grid-item" data-func="tarot">
                            <div class="func-name-wrap">
                                <i class="fa-solid fa-book"></i>
                                <span class="func-name">今日塔罗牌</span>
                            </div>
                            <span class="func-cost">消耗 8 喵币/次</span>
                        </div>
                        <div class="grid-item" data-func="unlock-character">
                            <div class="func-name-wrap">
                                <i class="fa-solid fa-mask"></i>
                                <span class="func-name">解锁人设</span>
                            </div>
                            <span class="func-cost">消耗 50 喵币/个</span>
                        </div>
                        <div class="grid-item" data-func="dream-analyze">
                            <div class="func-name-wrap">
                                <i class="fa-solid fa-cloud"></i>
                                <span class="func-name">梦境解析</span>
                            </div>
                            <span class="func-cost">消耗 10 喵币/次</span>
                        </div>
                        <div class="grid-item" data-func="cold-knowledge">
                            <div class="func-name-wrap">
                                <i class="fa-solid fa-lightbulb"></i>
                                <span class="func-name">冷知识推送</span>
                            </div>
                            <span class="func-cost">消耗 2 喵币/次</span>
                        </div>
                        <div class="grid-item" data-func="sign-in">
                            <div class="func-name-wrap">
                                <i class="fa-solid fa-calendar-check"></i>
                                <span class="func-name">每日签到</span>
                            </div>
                            <span class="func-cost">免费领取 2 喵币</span>
                        </div>
                        <div class="grid-item" data-func="watch-ad">
                            <div class="func-name-wrap">
                                <i class="fa-solid fa-video"></i>
                                <span class="func-name">看广告赚币</span>
                            </div>
                            <span class="func-cost">免费赚 3 喵币/次</span>
                        </div>
                        <div class="grid-item" data-func="donate">
                            <div class="func-name-wrap">
                                <i class="fa-solid fa-hand-holding-heart"></i>
                                <span class="func-name">喵币捐赠</span>
                            </div>
                            <span class="func-cost">捐赠任意数量</span>
                        </div>
                    </section>
                </div>
            </div>

            <div class="trade-record-modal" id="wallet-trade-modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">交易记录</div>
                        <i class="fa-solid fa-times close-modal" id="wallet-close-modal"></i>
                    </div>
                    <div class="record-list" id="wallet-record-list">
                        <div class="record-item">
                            <div class="record-icon">
                                <i class="fa-solid fa-calendar-check"></i>
                            </div>
                            <div class="record-info">
                                <div class="record-title">每日签到奖励</div>
                                <div class="record-time">2026-01-20 08:30</div>
                            </div>
                            <div class="record-amount amount-in">+2</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 子页面 - 世界书 -->
        <div class="sub-page" id="worldbook-page">
            <div class="sub-nav" style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); border-bottom: none; box-shadow: 0 2px 12px rgba(0,0,0,0.15);">
                <div class="back-btn" data-back="worldbook-page" style="color: #fff;">
                    <div class="back-arrow" style="border-color: #fff;"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title" style="color: #fff; font-weight: 600; letter-spacing: 0.5px;">世界书</div>
            </div>
            <div class="sub-content" style="padding: 0; background: linear-gradient(180deg, #f5f5f5 0%, #fafafa 100%);">
                <!-- 顶部操作区 -->
                <div style="padding: 20px 16px 16px; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <div style="display:flex;gap:12px;">
                        <button id="worldbook-add-btn" style="flex:1; height: 48px; background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%); color:#fff; border:none; border-radius:12px; cursor:pointer; font-size:14px; font-weight:600; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; justify-content: center; gap: 8px; letter-spacing: 0.3px;" onmouseenter="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(0,0,0,0.25)'" onmouseleave="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'">
                            <svg viewBox="0 0 24 24" style="width:20px;height:20px;fill:none;stroke:currentColor;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round;">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            新增世界书
                        </button>
                        <button id="worldbook-import-btn" style="flex:1; height: 48px; border:2px solid #e0e0e0; background:#fff; color:#333; border-radius:12px; cursor:pointer; font-size:14px; font-weight:600; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; justify-content: center; gap: 8px; letter-spacing: 0.3px;" onmouseenter="this.style.borderColor='#2c2c2c';this.style.background='#fafafa';this.style.transform='translateY(-2px)'" onmouseleave="this.style.borderColor='#e0e0e0';this.style.background='#fff';this.style.transform='translateY(0)'">
                            <svg viewBox="0 0 24 24" style="width:20px;height:20px;fill:none;stroke:currentColor;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round;">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            导入世界书
                        </button>
                        <input type="file" id="worldbook-import-input" accept=".json,.txt,.doc,.docx" multiple style="display:none;">
                    </div>
                </div>
                
                <!-- 内容区域 -->
                <div style="padding: 16px;">
                    <!-- 全局世界书 -->
                    <div style="margin-bottom:24px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom:16px; padding: 0 4px;">
                            <div style="width: 4px; height: 20px; background: linear-gradient(180deg, #2c2c2c 0%, #666 100%); border-radius: 2px;"></div>
                            <h3 style="margin: 0; font-size: 16px; font-weight: 700; color: #1a1a1a; letter-spacing: 0.3px;">全局世界书（线上）</h3>
                            <div style="flex: 1; height: 1px; background: linear-gradient(90deg, #e0e0e0 0%, transparent 100%);"></div>
                        </div>
                        <div id="global-worldbooks-list" style="display:flex;flex-direction:column;gap:12px;">
                            <div style="text-align:center;color:#999;padding:48px 20px;background:#fff;border-radius:16px;font-size:14px;border:2px dashed #e8e8e8;">
                                <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.3;">📚</div>
                                <div style="font-weight: 500;">暂无全局世界书</div>
                                <div style="font-size: 12px; color: #bbb; margin-top: 8px;">点击上方按钮创建或导入</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 局部世界书 -->
                    <div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom:16px; padding: 0 4px;">
                            <div style="width: 4px; height: 20px; background: linear-gradient(180deg, #666 0%, #999 100%); border-radius: 2px;"></div>
                            <h3 style="margin: 0; font-size: 16px; font-weight: 700; color: #1a1a1a; letter-spacing: 0.3px;">局部世界书（线上）</h3>
                            <div style="flex: 1; height: 1px; background: linear-gradient(90deg, #e0e0e0 0%, transparent 100%);"></div>
                        </div>
                        <div style="font-size: 12px; color: #999; margin-bottom: 12px; padding: 0 4px;">需绑定到特定角色使用</div>
                        <div id="local-worldbooks-list" style="display:flex;flex-direction:column;gap:12px;">
                            <div style="text-align:center;color:#999;padding:48px 20px;background:#fff;border-radius:16px;font-size:14px;border:2px dashed #e8e8e8;">
                                <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.3;">📖</div>
                                <div style="font-weight: 500;">暂无局部世界书</div>
                                <div style="font-size: 12px; color: #bbb; margin-top: 8px;">点击上方按钮创建或导入</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 线下世界书 -->
                    <div style="margin-top:24px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom:16px; padding: 0 4px;">
                            <div style="width: 4px; height: 20px; background: linear-gradient(180deg, #4a9eff 0%, #7cb7ff 100%); border-radius: 2px;"></div>
                            <h3 style="margin: 0; font-size: 16px; font-weight: 700; color: #1a1a1a; letter-spacing: 0.3px;">线下世界书</h3>
                            <div style="flex: 1; height: 1px; background: linear-gradient(90deg, #e0e0e0 0%, transparent 100%);"></div>
                        </div>
                        <div style="font-size: 12px; color: #999; margin-bottom: 12px; padding: 0 4px;">仅在线下功能中使用</div>
                        <div id="offline-worldbooks-list" style="display:flex;flex-direction:column;gap:12px;">
                            <div style="text-align:center;color:#999;padding:48px 20px;background:#fff;border-radius:16px;font-size:14px;border:2px dashed #e8e8e8;">
                                <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.3;">📕</div>
                                <div style="font-weight: 500;">暂无线下世界书</div>
                                <div style="font-size: 12px; color: #bbb; margin-top: 8px;">点击上方按钮创建或导入</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- 聊天页面 -->
        <div class="chat-page" id="chat-page">
            <div class="chat-nav">
                <div class="back-btn" id="chat-back-btn">
                    <div class="back-arrow"></div>
                </div>
                <div class="chat-title-area">
                    <div class="chat-title" id="chat-title">AI小助手</div>
                </div>
                <div class="chat-toolbar-buttons">
                    <button id="chat-mind-btn">
                        <svg id="chat-mind-heart" viewBox="0 0 24 24" style="width:24px;height:24px;position:relative;">
                            <!-- 空心爱心轮廓 -->
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
                                  stroke="#ffd5e0"
                                  stroke-width="1.5"
                                  fill="none"/>
                            <!-- 填充部分（根据好感度动态变化） -->
                            <defs>
                                <clipPath id="heart-clip">
                                    <rect id="heart-fill-rect" x="0" y="0" width="24" height="24"/>
                                </clipPath>
                            </defs>
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
                                  fill="#e8e8e8"
                                  clip-path="url(#heart-clip)"
                                  style="transition: all 0.3s ease;"/>
                            <!-- 好感度数值 -->
                            <text id="heart-affinity-text"
                                  x="12"
                                  y="14"
                                  text-anchor="middle"
                                  font-size="7"
                                  font-weight="bold"
                                  fill="#666"
                                  style="pointer-events: none;">0</text>
                        </svg>
                    </button>
                    <button class="chat-more" id="chat-more-btn" type="button">
                        <div class="chat-more-hamburger">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </button>
                </div>
            </div>
            
            <div class="chat-messages" id="chat-messages"></div>
            
            <!-- 引用消息栏(在消息区域和输入框之间) -->
            <div class="quote-message-bar-container" id="quote-message-bar-container" style="display:none;">
                <div class="quote-message-bar" id="quote-message-bar">
                    <div class="quote-content" id="quote-content"></div>
                    <button class="quote-cancel-btn" id="quote-cancel-btn">×</button>
                </div>
            </div>

            <!-- AI回复中的打字指示器 -->
            <div class="chat-typing-indicator" id="chat-typing-indicator">
                <div class="chat-typing-dots">
                    <span></span><span></span><span></span>
                </div>
            </div>

            <!-- 输入区域(在工具栏上方) -->
            <div class="chat-input-area">
                <textarea class="chat-input" id="chat-input" placeholder="输入消息" rows="1"></textarea>
                <button class="chat-send-btn" id="chat-send-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M22 2L11 13"></path>
                        <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
                    </svg>
                </button>
            </div>

            <!-- 工具栏(在最底部) -->
            <div class="chat-toolbar" id="chat-toolbar">
                <button class="tb-btn" id="btn-reply" title="回复">
                    <svg viewBox="0 0 24 24"><path d="M9 14L4 9l5-5M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11"></path></svg>
                    <span class="tb-btn-label">回复</span>
                </button>
                <button class="tb-btn" id="btn-retry" title="重回">
                    <svg viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36M20.49 15a9 9 0 0 1-14.85 3.36"></path></svg>
                    <span class="tb-btn-label">重回</span>
                </button>
                <button class="tb-btn" id="btn-emoji" title="表情包">
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><circle cx="9" cy="9" r="1"></circle><circle cx="15" cy="9" r="1"></circle></svg>
                    <span class="tb-btn-label">表情</span>
                </button>
                <button class="tb-btn" id="btn-voice-msg" title="语音条">
                    <svg viewBox="0 0 24 24"><path d="M12 1a4 4 0 0 0-4 4v7a4 4 0 0 0 8 0V5a4 4 0 0 0-4-4z"></path><path d="M8 19a6 6 0 0 0 8 0"></path><line x1="12" y1="19" x2="12" y2="23"></line></svg>
                    <span class="tb-btn-label">语音</span>
                </button>
                <button class="tb-btn" id="btn-phone" title="查手机">
                    <svg viewBox="0 0 24 24"><rect x="5" y="2" width="14" height="20" rx="2.5" ry="2.5"></rect><path d="M12 21h0"></path></svg>
                    <span class="tb-btn-label">查手机</span>
                </button>
                <button class="tb-btn" id="btn-more" title="更多">
                    <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    <span class="tb-btn-label">更多</span>
                </button>
                <input type="file" id="toolbar-file-input" accept="image/*" style="display:none">
            </div>

            <!-- 更多功能面板 - QQ风格 -->
            <div class="toolbar-more-panel" id="toolbar-more-panel">
                <div class="more-panel-close">
                    <div class="more-panel-close-btn"></div>
                </div>
                <div class="more-panel-swiper" id="more-panel-swiper">
                    <!-- 第一页 -->
                    <div class="more-panel-page">
                        <div class="more-panel-grid">
                            <button class="more-item" id="more-camera" title="拍照">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><path d="M23 19V5a2 2 0 0 0-2-2H3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                                </div>
                                <span>拍照</span>
                            </button>
                            <button class="more-item" id="more-photo" title="照片">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                                </div>
                                <span>照片</span>
                            </button>
                            <button class="more-item" id="more-location" title="位置">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                                </div>
                                <span>位置</span>
                            </button>
                            <button class="more-item" id="more-voicecall" title="语音通话">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                </div>
                                <span>语音通话</span>
                            </button>
                            <button class="more-item" id="more-videocall" title="视频通话">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                                </div>
                                <span>视频通话</span>
                            </button>
                            <button class="more-item" id="more-redenvelope" title="红包">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="5" width="18" height="14" rx="2" ry="2"></rect><path d="M3 9 L12 14 L21 9"></path><circle cx="12" cy="13" r="1.5" fill="currentColor"></circle></svg>
                                </div>
                                <span>红包</span>
                            </button>
                            <button class="more-item" id="more-transfer" title="转账">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="5" width="18" height="14" rx="2" ry="2"></rect><line x1="3" y1="10" x2="21" y2="10"></line><circle cx="7" cy="14" r="1" fill="currentColor"></circle></svg>
                                </div>
                                <span>转账</span>
                            </button>
                            <button class="more-item" id="more-takeout" title="购物">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                                </div>
                                <span>购物</span>
                            </button>
                        </div>
                    </div>
                    <!-- 第二页 -->
                    <div class="more-panel-page">
                        <div class="more-panel-grid">
                            <button class="more-item" id="more-offline" title="线下功能">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><polyline points="12 5 12 19"></polyline><polyline points="19 12 12 19 5 12"></polyline></svg>
                                </div>
                                <span>线下功能</span>
                            </button>
                            <button class="more-item" id="more-listen" title="一起听">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><path d="M12 1a9 9 0 0 0-9 9v3a9 9 0 0 0 18 0v-3a9 9 0 0 0-9-9z"></path><path d="M6 14v5a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-5"></path><path d="M16 14v5a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-5"></path></svg>
                                </div>
                                <span>一起听</span>
                            </button>
                            <button class="more-item" id="more-fiction" title="同人文">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><path d="M6 4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h6V4H6z"></path><path d="M12 4h6c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2h-6V4z"></path><line x1="12" y1="4" x2="12" y2="20"></line><line x1="8" y1="8" x2="10" y2="8"></line><line x1="8" y1="11" x2="10" y2="11"></line><line x1="8" y1="14" x2="10" y2="14"></line><line x1="14" y1="8" x2="16" y2="8"></line><line x1="14" y1="11" x2="16" y2="11"></line><line x1="14" y1="14" x2="16" y2="14"></line></svg>
                                </div>
                                <span>同人文</span>
                            </button>
                            <button class="more-item" id="more-diary" title="情书">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><rect x="2" y="4" width="20" height="16" rx="2"></rect><path d="M2 6l10 7 10-7"></path></svg>
                                </div>
                                <span>情书</span>
                            </button>
                            <button class="more-item" id="more-memo" title="备忘录">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                                </div>
                                <span>备忘录</span>
                            </button>
                            <button class="more-item" id="more-frog" title="旅行青蛙">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="8" ry="6"></ellipse><circle cx="7" cy="10" r="1.5" fill="#666"></circle><circle cx="17" cy="10" r="1.5" fill="#666"></circle><path d="M9 16c3 1 6 1 6 0"></path><path d="M4 8l-2-1M20 8l2-1"></path></svg>
                                </div>
                                <span>旅行青蛙</span>
                            </button>
                            <button class="more-item" id="more-anonymous" title="匿名提问">
                                <div class="more-item-icon">
                                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                                </div>
                                <span>匿名提问</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="more-panel-dots">
                    <div class="more-panel-dot active"></div>
                    <div class="more-panel-dot"></div>
                </div>
            </div>

            <div class="emoji-library" id="emoji-library" style="display:none;">
                <div class="emoji-lib-header">
                    <button class="emoji-lib-btn" id="emoji-add-btn" title="导入文件">
                        <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:#666;stroke-width:1.8;fill:none;stroke-linecap:round;stroke-linejoin:round;"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    </button>
                    <button class="emoji-lib-btn" id="emoji-add-url-btn" title="导入URL">
                        <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:#666;stroke-width:1.8;fill:none;stroke-linecap:round;stroke-linejoin:round;"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                    </button>
                    <div class="emoji-groups-bar" id="emoji-groups-bar" style="display:none;"></div>
                    <button class="emoji-lib-btn" id="emoji-group-btn" title="分组管理">
                        <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:#666;stroke-width:1.8;fill:none;stroke-linecap:round;stroke-linejoin:round;"><circle cx="6" cy="6" r="2"></circle><circle cx="18" cy="6" r="2"></circle><circle cx="6" cy="18" r="2"></circle><circle cx="18" cy="18" r="2"></circle><line x1="8" y1="6" x2="16" y2="6"></line><line x1="8" y1="18" x2="16" y2="18"></line><line x1="6" y1="8" x2="6" y2="16"></line><line x1="18" y1="8" x2="18" y2="16"></line></svg>
                    </button>
                </div>
                <div class="emoji-grid" id="emoji-grid"></div>
                <input type="file" id="emoji-upload-input" accept="image/*,.json" multiple style="display:none">
            </div>

        </div>

        <!-- 个性名片编辑页面 -->
        <div class="card-edit-page" id="card-edit-page">
            <div class="sub-nav">
                <div class="back-btn" id="card-edit-back-btn">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">编辑资料</div>
            </div>
            
            <div class="card-edit-preview" id="card-edit-preview">
                <div class="card-edit-preview-avatar" id="card-edit-preview-avatar">喵</div>
                <div class="card-edit-preview-name" id="card-edit-preview-name">小喵1号</div>
                <div class="card-edit-preview-sig" id="card-edit-preview-sig">这个人很懒，什么都没写~</div>
            </div>
            
            <div class="edit-list">
                <div class="edit-section">
                    <div class="edit-item" id="edit-avatar-btn">
                        <div class="edit-label">头像</div>
                        <div class="edit-value">
                            <div class="edit-avatar-small" id="edit-avatar-small"></div>
                            <div class="edit-arrow"></div>
                        </div>
                    </div>
                    
                    <div class="edit-item" id="edit-bg-btn">
                        <div class="edit-label">背景图</div>
                        <div class="edit-value">
                            <span id="edit-bg-value">默认</span>
                            <div class="edit-arrow"></div>
                        </div>
                    </div>
                    
                    <div class="edit-item" id="edit-name-btn">
                        <div class="edit-label">昵称</div>
                        <div class="edit-value">
                            <span id="edit-name-value">小喵1号</span>
                            <div class="edit-arrow"></div>
                        </div>
                    </div>
                    
                    <div class="edit-item" id="edit-signature-btn">
                        <div class="edit-label">个性签名</div>
                        <div class="edit-value">
                            <span id="edit-signature-value">这个人很懒，什么都没写~</span>
                            <div class="edit-arrow"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 表情包管理页面 (全屏子页面) -->
        <div class="emoji-manager-page" id="emoji-manager-page" style="display:none;">
            <!-- 顶部导航栏 -->
            <div class="sub-nav">
                <div class="back-btn" id="emoji-manager-back-btn">
                    <div class="back-arrow"></div>
                    <span>返回</span>
                </div>
                <div class="sub-title">表情包管理</div>
            </div>
            
            <!-- 功能按钮区 -->
            <div class="emoji-manager-toolbar">
                <!-- 第一行：导入按钮 -->
                <div class="emoji-toolbar-row">
                    <button class="emoji-manager-btn" id="emoji-manager-import-image">
                        <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:currentColor;stroke-width:2;fill:none;">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                        <span>导入图片</span>
                    </button>
                    <button class="emoji-manager-btn" id="emoji-manager-import-json">
                        <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:currentColor;stroke-width:2;fill:none;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="12" y1="18" x2="12" y2="12"></line>
                            <line x1="9" y1="15" x2="15" y2="15"></line>
                        </svg>
                        <span>导入JSON</span>
                    </button>
                    <button class="emoji-manager-btn" id="emoji-manager-import-url">
                        <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:currentColor;stroke-width:2;fill:none;">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                        <span>URL</span>
                    </button>
                </div>
                <!-- 第二行：批量操作按钮 -->
                <div class="emoji-toolbar-row">
                    <button class="emoji-manager-btn" id="emoji-manager-select-mode">
                        <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:currentColor;stroke-width:2;fill:none;">
                            <polyline points="9 11 12 14 22 4"></polyline>
                            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                        </svg>
                        <span>批量选择</span>
                    </button>
                    <button class="emoji-manager-btn" id="emoji-manager-cancel-select" style="display:none;">
                        <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:currentColor;stroke-width:2;fill:none;">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        <span>取消选择</span>
                    </button>
                </div>
            </div>
            
            <!-- 分组标签栏 -->
            <div class="emoji-manager-groups" id="emoji-manager-groups">
                <!-- 分组标签将在这里动态生成 -->
            </div>
            
            <!-- 表情包内容区 -->
            <div class="emoji-manager-content" id="emoji-manager-content">
                <div class="emoji-manager-empty">
                    <div style="font-size:48px;margin-bottom:8px;">🙂</div>
                    <div>该分组下暂无表情包</div>
                    <div style="font-size:12px;color:#999;margin-top:8px;">点击上方按钮导入表情包</div>
                </div>
            </div>
            
            <!-- 隐藏的文件输入 -->
            <input type="file" id="emoji-manager-image-input" accept="image/*" multiple style="display:none">
            <input type="file" id="emoji-manager-json-input" accept=".json,application/json" style="display:none">
        </div>

        <!-- 图片选择弹窗 -->
        <div class="image-picker-modal" id="image-picker-modal">
            <div class="image-picker-content">
                <div class="picker-title" id="picker-title">选择图片</div>
                
                <div class="picker-option" id="picker-local">
                    <div class="picker-option-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24" style="width:24px;height:24px;">
                            <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <path d="M21 15l-5-5L5 21"></path>
                        </svg>
                    </div>
                    <div class="picker-option-text">从本地相册选择</div>
                </div>
                
                <div class="picker-option" id="picker-url-toggle">
                    <div class="picker-option-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24" style="width:24px;height:24px;">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3 -3l3 -3l3 0"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                    </div>
                    <div class="picker-option-text">输入图片URL</div>
                </div>
                
                <input type="text" class="picker-url-input hidden" id="picker-url-input" placeholder="请输入图片URL地址">
                <button class="picker-url-confirm hidden" id="picker-url-confirm">确认</button>
                
                <input type="file" id="picker-file-input" accept="image/*,.jpg,.jpeg,.png,.gif,.webp" style="display:none;">
                
                <button class="picker-cancel" id="picker-cancel">取消</button>
            </div>
        </div>

        <!-- 更多功能设置弹窗 -->
        <div class="more-settings-modal" id="more-settings-modal">
            <div class="more-settings-content">
                <div class="more-settings-header">
                    <div class="more-settings-title">动态页面设置</div>
                    <div class="more-settings-desc">选择要在动态页面显示的功能</div>
                </div>
                
                <div class="more-settings-list" id="more-settings-list">
                    <div class="more-settings-item" data-func-id="moments">
                        <div class="more-settings-item-left">
                            <div class="more-settings-item-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <path d="M21 15l-5-5L5 21"></path>
                                </svg>
                            </div>
                            <div class="more-settings-item-name">朋友圈</div>
                        </div>
                        <div class="toggle-switch active" data-func-id="moments"></div>
                    </div>
                    
                <div class="more-settings-item" data-func-id="forum">
                        <div class="more-settings-item-left">
                            <div class="more-settings-item-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    <line x1="8" y1="8" x2="16" y2="8"></line>
                                    <line x1="8" y1="12" x2="14" y2="12"></line>
                                </svg>
                            </div>
                            <div class="more-settings-item-name">论坛</div>
                        </div>
                        <div class="toggle-switch active" data-func-id="forum"></div>
                    </div>

                <div class="more-settings-item" data-func-id="reading">
                    <div class="more-settings-item-left">
                        <div class="more-settings-item-icon">
                            <svg class="icon-svg" viewBox="0 0 24 24">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                                <line x1="8" y1="7" x2="16" y2="7"></line>
                                <line x1="8" y1="11" x2="14" y2="11"></line>
                            </svg>
                        </div>
                        <div class="more-settings-item-name">阅读</div>
                    </div>
                    <div class="toggle-switch active" data-func-id="reading"></div>
                </div>

                    <div class="more-settings-item" data-func-id="calendar">
                        <div class="more-settings-item-left">
                            <div class="more-settings-item-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </div>
                            <div class="more-settings-item-name">日历</div>
                        </div>
                        <div class="toggle-switch active" data-func-id="calendar"></div>
                    </div>
                    
                    <div class="more-settings-item" data-func-id="weather">
                        <div class="more-settings-item-left">
                            <div class="more-settings-item-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </div>
                            <div class="more-settings-item-name">天气</div>
                        </div>
                        <div class="toggle-switch active" data-func-id="weather"></div>
                     </div>

                    <div class="more-settings-item" data-func-id="shopping">
                        <div class="more-settings-item-left">
                            <div class="more-settings-item-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </div>
                            <div class="more-settings-item-name">购物</div>
                        </div>
                        <div class="toggle-switch active" data-func-id="shopping"></div>
                    </div>
                    
                    <div class="more-settings-item" data-func-id="game">
                        <div class="more-settings-item-left">
                            <div class="more-settings-item-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <rect x="2" y="6" width="20" height="12" rx="2"></rect>
                                    <circle cx="6" cy="12" r="1.5"></circle>
                                    <circle cx="10" cy="12" r="1.5"></circle>
                                    <path d="M15 10v4"></path>
                                    <path d="M13 12h4"></path>
                                </svg>
                            </div>
                            <div class="more-settings-item-name">游戏中心</div>
                        </div>
                        <div class="toggle-switch active" data-func-id="game"></div>
                    </div>

                    <div class="more-settings-item" data-func-id="tacit">
                        <div class="more-settings-item-left">
                            <div class="more-settings-item-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                            </div>
                            <div class="more-settings-item-name">默契大挑战</div>
                        </div>
                        <div class="toggle-switch active" data-func-id="tacit"></div>
                    </div>

                    <div class="more-settings-item" data-func-id="spiritGalaxy">
                        <div class="more-settings-item-left">
                            <div class="more-settings-item-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <polygon points="12 2 15.09 10.26 23.77 10.26 17.39 16.01 20.48 24.27 12 18.46 3.52 24.27 6.61 16.01 0.23 10.26 8.91 10.26"></polygon>
                                </svg>
                            </div>
                            <div class="more-settings-item-name">心灵星系</div>
                        </div>
                        <div class="toggle-switch active" data-func-id="spiritGalaxy"></div>
                    </div>

                    <div class="more-settings-item" data-func-id="ideaLibrary">
                        <div class="more-settings-item-left">
                            <div class="more-settings-item-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8.5 8.5z"></path>
                                    <line x1="12" y1="7" x2="12" y2="13"></line>
                                    <line x1="9" y1="10" x2="15" y2="10"></line>
                                </svg>
                            </div>
                            <div class="more-settings-item-name">灵感库</div>
                        </div>
                        <div class="toggle-switch active" data-func-id="ideaLibrary"></div>
                    </div>

                    <div class="more-settings-item" data-func-id="thirdParty">
                        <div class="more-settings-item-left">
                            <div class="more-settings-item-icon">
                                <svg class="icon-svg" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                </svg>
                            </div>
                            <div class="more-settings-item-name">观察者</div>
                        </div>
                        <div class="toggle-switch active" data-func-id="thirdParty"></div>
                    </div>
                
                <div class="more-settings-footer">
                    <button class="more-settings-confirm" id="more-settings-confirm">确定</button>
                </div>
            </div>
        </div>

    </div>

    <!-- 视频通话界面 -->
    <div id="video-call-interface" class="video-call-interface">
        <!-- 等待连接状态 -->
        <div class="video-waiting-status">
            <div class="video-waiting-icon"></div>
            <div class="video-waiting-text">正在呼叫中...</div>
        </div>
        
        <!-- 主屏幕（全屏背景） -->
        <div id="video-main-screen" class="video-main-screen"></div>
        
        <!-- 小屏幕（右上角） -->
        <div id="video-small-screen" class="video-small-screen"></div>
        
        <!-- 顶部工具栏 -->
        <div class="video-call-header">
            <button class="video-call-minimize-btn" id="video-call-minimize-btn" title="最小化">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path d="M19 13H5v-2h14v2z" fill="currentColor"/>
                </svg>
            </button>
            <div class="video-call-header-title">视频通话中</div>
            <div class="video-call-header-buttons">
                <button class="video-call-header-btn" id="video-manage-photos-btn" title="管理照片" onclick="if(window.VideoCallSystem) window.VideoCallSystem.openPhotoManager()">
                    <svg viewBox="0 0 24 24">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- 聊天区域（居中透明） -->
        <div class="video-chat-container" id="video-chat-container">
            <div id="video-chat-messages" class="video-chat-messages"></div>
        </div>
        
        <!-- 聊天输入框（居中，往上移动） -->
        <div class="video-chat-input-wrapper" id="video-chat-input-wrapper">
            <!-- AI回复中的三点加载指示器 -->
            <div class="video-chat-typing-indicator" id="video-chat-typing-indicator">
                <div class="video-chat-typing-dots">
                    <span></span><span></span><span></span>
                </div>
            </div>
            <div class="video-chat-input-container">
                <input type="text" id="video-chat-input" class="video-chat-input" placeholder="" />
                <button class="video-chat-send-btn" id="video-chat-send-btn" onclick="if(window.VideoCallSystem) window.VideoCallSystem.sendMessage()"></button>
            </div>
        </div>
        
        <!-- 底部控制栏（参考语音通话） -->
        <div class="video-call-controls">
            <div class="video-call-duration" id="video-call-duration">00:00</div>
            <div class="video-call-buttons">
                <button class="video-call-control-btn" id="video-mute-btn" title="麦克风">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" fill="currentColor"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" fill="currentColor"/>
                    </svg>
                </button>
                
                <button class="video-call-control-btn" id="video-speaker-btn" title="外放">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z" fill="currentColor"/>
                    </svg>
                </button>
                
                <button class="video-call-control-btn video-end-btn" id="video-end-btn" title="挂断">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.68-1.36-2.66-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- 照片管理弹窗 -->
    <div id="video-photo-manager-modal" class="video-photo-manager-modal" style="display: none;">
        <div class="video-photo-manager-content">
            <div class="video-photo-manager-header">
                <h3>管理照片库</h3>
                <button class="video-photo-manager-close" onclick="document.getElementById('video-photo-manager-modal').style.display='none'">×</button>
            </div>
            <div class="video-photo-manager-body">
                <div class="video-photo-section">
                    <h4>角色照片库</h4>
                    <div id="character-photos-grid" class="video-photos-grid"></div>
                    <button class="video-add-photo-btn" id="add-character-photo-btn">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        添加角色照片
                    </button>
                </div>
                <div class="video-photo-section">
                    <h4>用户照片库</h4>
                    <div id="user-photos-grid" class="video-photos-grid"></div>
                    <button class="video-add-photo-btn" id="add-user-photo-btn">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        添加用户照片
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 视频通话悬浮窗（背景是角色照片） -->
    <div id="video-call-floating-window" class="video-call-floating-window">
        <div class="video-floating-bg" id="video-floating-bg"></div>
        <div class="video-floating-overlay"></div>
        <div id="video-floating-duration" class="video-floating-duration">00:00</div>
    </div>

    <script src="video-call.js"></script>
    <script src="red-envelope.js"></script>
    <script src="transfer.js"></script>
    <script src="shopping.js"></script>
    <script src="shopping-cart.js"></script>
    <script src="mine-edit.js"></script>
    <script src="address-manager.js"></script>
    <script src="listen-together.js"></script>

    <!-- Edge和Chrome全屏修复脚本 -->
    <script>
        (function() {
            // 检测浏览器和设备
            const ua = navigator.userAgent;
            const isEdge = /Edg/.test(ua);
            const isChrome = /Chrome/.test(ua) && !/Edg/.test(ua);
            const isAndroid = /Android/.test(ua);
            
            // 检测是否为PWA模式（添加到桌面）
            const isPWA = window.matchMedia('(display-mode: standalone)').matches ||
                         window.matchMedia('(display-mode: fullscreen)').matches ||
                         window.navigator.standalone;
            
            // 修复Edge和Chrome的全屏问题
            if ((isEdge || isChrome) && isAndroid && isPWA) {
                // 强制设置视口高度为100vh
                const setFullscreenHeight = () => {
                    const vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                    document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
                    
                    // 隐藏地址栏
                    if (window.scrollY === 0) {
                        window.scrollTo(0, 1);
                    }
                };
                
                // 初始化
                setFullscreenHeight();
                
                // 监听resize事件
                window.addEventListener('resize', setFullscreenHeight);
                
                // 监听orientationchange事件
                window.addEventListener('orientationchange', () => {
                    setTimeout(setFullscreenHeight, 300);
                });
                
                // 页面加载完成后再次调整
                window.addEventListener('load', () => {
                    setTimeout(setFullscreenHeight, 500);
                });
                
                // 标记为Edge/Chrome PWA模式
                document.documentElement.classList.add('edge-chrome-pwa');
                if (isEdge) {
                    document.documentElement.classList.add('is-edge-pwa');
                }
                if (isChrome) {
                    document.documentElement.classList.add('is-chrome-pwa');
                }
            }
        })();
    </script>

</body>
</html>